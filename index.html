<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>××¨×’×•×Ÿ ×•×¡×“×¨ â€“ ×¡×˜×¤× ×™</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:"Heebo",sans-serif}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 28px rgba(0,0,0,.08)}
    .pill{background:#f1f5f9;border-radius:999px;padding:.25rem .6rem;font-size:.8rem}
    .done{opacity:.6;text-decoration:line-through}
    .btn{border-radius:10px;padding:.55rem .9rem}
    .btn-ghost{background:#f8fafc}
    .check-item{display:flex;gap:.5rem;justify-content:space-between;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .75rem;margin:.35rem 0}
    .tiny{font-size:.82rem;color:#64748b}
    a.link{color:#7c3aed;text-decoration:underline}
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <div class="max-w-5xl mx-auto p-5 md:p-10">
    <header class="text-center mb-6">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800">ğŸ  ××¨×’×•×Ÿ ×•×¡×“×¨</h1>
      <p class="text-gray-600">×™×•××™ + ×‘× ×•×ª + ××•×¨×›×‘×•×ª ×¡×•×¤×´×© + ×ª×›× ×™×ª ×××•×§×“×ª</p>
    </header>

    <!-- ×¡×˜×˜×•×¡ -->
    <section class="card p-5 mb-6">
      <div class="grid grid-cols-3 gap-3 text-center">
        <div class="bg-green-50 rounded-lg p-3">
          <div id="stat-done" class="text-2xl font-bold text-green-600">0</div>
          <div class="text-sm text-green-700">×”×•×©×œ××• ×”×™×•×</div>
        </div>
        <div class="bg-blue-50 rounded-lg p-3">
          <div id="stat-active" class="text-2xl font-bold text-blue-600">0</div>
          <div class="text-sm text-blue-700">×¤×¢×™×œ×™× ×¢×›×©×™×•</div>
        </div>
        <div class="bg-purple-50 rounded-lg p-3">
          <div id="stat-total" class="text-2xl font-bold text-purple-600">0</div>
          <div class="text-sm text-purple-700">×¡×”×´×› ×”×™×•×</div>
        </div>
      </div>
    </section>

    <!-- ××©×™××•×ª ×™×•××™×•×ª -->
    <section class="mb-6">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-semibold text-gray-800">×”××©×™××•×ª ×©×œ×™ ×”×™×•×</h2>
        <button id="btn-new" class="btn bg-blue-600 text-white hover:bg-blue-700">ğŸ”„ ××©×™××•×ª ×—×“×©×•×ª</button>
      </div>
      <div id="mine" class="grid md:grid-cols-2 gap-4"></div>
    </section>

    <!-- ×‘× ×•×ª -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">ğŸ‘§ ××©×™××•×ª ×œ×‘× ×•×ª</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-bold">××¤×œ (10)</h3>
            <span class="pill">×§×œ×™×œ</span>
          </div>
          <div id="kids-mafal" class="mt-2"></div>
        </div>
        <div class="card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-bold">××¢×™×™×Ÿ (8)</h3>
            <span class="pill">×§×œ×™×œ</span>
          </div>
          <div id="kids-maayan" class="mt-2"></div>
        </div>
      </div>
    </section>

    <!-- ×¡×•×¤×´×© ××•×¨×›×‘ -->
    <section class="mb-6 card p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800">ğŸŸ£ ××©×™××•×ª ××•×¨×›×‘×•×ª ×œ×¡×•×¤×´×©</h2>
        <span id="weekend-note" class="tiny"></span>
      </div>
      <div id="weekend" class="mt-2"></div>
    </section>

    <!-- ×ª×›× ×™×ª ×××•×§×“×ª -->
    <section class="mb-8 card p-5">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">ğŸ§­ ×ª×›× ×™×ª ×××•×§×“×ª ×œ××–×•×¨</h2>
      <textarea id="focus-input" rows="5" class="w-full p-3 border rounded-lg mb-3" placeholder="×”×“×‘×™×§×™ ×›××Ÿ ×¦×¢×“×™× â€” ×›×œ ×©×•×¨×” ×¦×¢×“"></textarea>
      <div class="flex flex-wrap gap-2 mb-3">
        <button id="btn-make" class="btn bg-purple-600 text-white hover:bg-purple-700">âœ… ×¦×•×¨/×¢×“×›×Ÿ ×¦×³×§-×œ×™×¡×˜</button>
        <button id="btn-hide-done" class="btn btn-ghost">ğŸ§¹ ×”×¡×ª×¨ ×©×”×•×©×œ××•</button>
        <button id="btn-show-all" class="btn btn-ghost">ğŸ‘€ ×”×¦×’ ×”×›×•×œ</button>
        <button id="btn-clear" class="btn btn-ghost">ğŸ—‘ï¸ × ×§×” ×¦×³×§-×œ×™×¡×˜</button>
      </div>
      <div id="focus-list"></div>
      <p class="tiny mt-2">×˜×™×¤: ×©×ª×¤×™ ×›××Ÿ ×¦×™×œ×•× ××–×•×¨ ×•×× ×™ ××›×™×Ÿ ×œ×š ×ª×›× ×™×ª ××•×“×‘×§×ª ××•×›× ×” ×¢× ×¦×¢×“×™×.</p>
    </section>

    <footer class="text-center text-sm text-gray-500 pb-10">
      × ×©××¨ ××•×˜×•××˜×™×ª ×‘××›×©×™×¨ (localStorage). ×œ×›×œ ××—×ª ×”×“×¤×“×•×£ ×©×œ×” ğŸ’¾
    </footer>
  </div>

  <script>
    /* ===================== × ×ª×•× ×™× ===================== */
    const YT = {
      kitchen: "https://youtu.be/3Xnu3MpnV-g",
      konmari: "https://youtu.be/-2gHqY7cA6Y",
      living: "https://youtu.be/_h1Q3BfEzyI",
      entry: "https://youtu.be/1oYw4yQ8u7A",
      toys: "https://youtu.be/WYyPjW7OVoA",
      wardrobe: "https://youtu.be/6m1r1N2A8YQ",
      bathroom: "https://youtu.be/5HqgYQqS9Ow",
      laundry: "https://youtu.be/k5yJw0oM8vE"
    };

    const MASTER = [
      { id:"sink",     title:"×©×˜×™×¤×ª ×›×œ×™× ×‘×¡×™×¡×™×ª + ×›×™×•×¨", time:"10â€“15 ×“×³", tip:"×œ×”×ª×—×™×œ ××“×‘×¨×™× ×’×“×•×œ×™× â†’ ××©×¨×™× â†’ ×§×˜× ×™×", video:YT.kitchen },
      { id:"counters", title:"× ×™×§×•×™ ××©×˜×— ××˜×‘×—",          time:"8â€“10 ×“×³",  tip:"×©×××œâ†’×™××™×Ÿ ×¡×™×‘×•×‘ ××—×“, ×‘×œ×™ ×œ×¤×ª×•×— ××¨×•× ×•×ª", video:YT.kitchen },
      { id:"living",   title:"×¡×™×“×•×¨ ×¡×œ×•×Ÿ × ×¨××” ×œ×¢×™×Ÿ",      time:"7â€“10 ×“×³",  tip:"×§×•×¤×¡×ª ××™×¡×•×£ ××—×ª, ×œ× ××—×œ×™×˜×•×ª ×¢×›×©×™×•", video:YT.living },
      { id:"entry",    title:"×›× ×™×¡×”: × ×¢×œ×™×™× + ××¢×™×œ×™×",    time:"5â€“8 ×“×³",   tip:"×–×•×’ ××—×“ ×œ××“× ×œ×™×“ ×”×“×œ×ª, ×”×©××¨ ×œ××¨×•×Ÿ", video:YT.entry },
      { id:"bath",     title:"× ×™×’×•×‘ ××”×™×¨ ×××‘×˜×™×”",         time:"8â€“12 ×“×³",  tip:"×‘×¨×–/×›×™×•×¨/××¡×œ×” â€“ ××¢×’×œ ××—×“", video:YT.bathroom },
      { id:"desk",     title:"×©×•×œ×—×Ÿ ×¢×‘×•×“×” × ×§×™ ×œ×¢×™×Ÿ",      time:"5â€“8 ×“×³",   tip:"×œ×©×™× ×”×›×•×œ ×œ×§×•×¤×¡×ª '×ª×œ×•×™ ×”×—×œ×˜×”'", video:YT.konmari }
    ];

    // ×œ×™×œ×“×•×ª â€“ ×§×œ×•×ª
    const KIDS = {
      mafal: [
        {id:"m1", title:"ğŸ“š ×œ×”×›×™×Ÿ ×ª×™×§ ×œ××—×¨", time:"5 ×“×³", tip:"×¨×©×™××ª ×©×™×¢×•×¨×™× ×¢×œ ×”×©×•×œ×—×Ÿ", video:YT.living},
        {id:"m2", title:"ğŸ§¦ ×œ×”×‘×™× ×›×‘×™×¡×” ×œ×¡×œ", time:"3 ×“×³", tip:"×¡×™×‘×•×‘ ××”×™×¨ ×—×“×¨â†’×¡×œ ×›×‘×™×¡×”", video:YT.laundry},
        {id:"m3", title:"ğŸ§¸ ×œ×¡×“×¨ 10 ×¦×¢×¦×•×¢×™×", time:"5 ×“×³", tip:"×˜×™×™××¨ 5 ×“×³ â€“ ×¢×•×©×™× ××©×—×§!", video:YT.toys},
        {id:"m4", title:"ğŸ½ï¸ ×œ×¢×–×•×¨ ×œ×¢×¨×•×š ×©×•×œ×—×Ÿ", time:"5 ×“×³", tip:"××¤×™×•×ª/×¡×›×•×´× ×‘×œ×‘×“", video:YT.kitchen}
      ],
      maayan: [
        {id:"y1", title:"ğŸ§¸ ×œ×¡×“×¨ 10 ×¦×¢×¦×•×¢×™×", time:"5 ×“×³", tip:"×˜×™×™××¨ 5 ×“×³ â€“ ×¢×•×©×™× ××©×—×§!", video:YT.toys},
        {id:"y2", title:"ğŸ§¦ ×œ×”×‘×™× ×›×‘×™×¡×” ×œ×¡×œ", time:"3 ×“×³", tip:"×ª×—×¨×•×ª ××™ ××•×¡×¤×ª ×™×•×ª×¨", video:YT.laundry},
        {id:"y3", title:"ğŸ¥¤ ×œ××¡×•×£ ×‘×§×‘×•×§×™×/×›×•×¡×•×ª ×‘×¡×œ×•×Ÿ", time:"4 ×“×³", tip:"×˜×¨×™×™/××’×© ××—×“", video:YT.living},
        {id:"y4", title:"ğŸ¥¿ ×œ×¡×“×¨ × ×¢×œ×™×™× ×‘×›× ×™×¡×”", time:"4 ×“×³", tip:"×–×•×’ ××—×“ ×¢×œ ×”××“×£", video:YT.entry}
      ]
    };

    // ××–×•×¨×™ ×¡×•×¤×´×© ×œ×¤×™ ×©×‘×•×¢
    const WEEKEND = [
      {key:"kitchen", label:"ğŸ³ ×¡×™×“×•×¨ ××¨×•× ×•×ª ××˜×‘×— (××“×£ ××—×“ ××œ×)", video:YT.kitchen, tip:"××“×£ ××—×“ ×‘×œ×‘×“! ×œ×¨×•×§×Ÿâ†’×œ××™×™×Ÿâ†’×œ×”×—×–×™×¨"},
      {key:"laundry", label:"ğŸ§º ××¨×’×•×Ÿ ×—×“×¨ ×©×™×¨×•×ª", video:YT.laundry, tip:"×¡×œ ×›×‘×™×¡×”/×—×•××¨×™ × ×™×§×•×™ â€“ ×§×•×¤×¡××•×ª"},
      {key:"wardrobe",label:"ğŸ‘— ××¨×•×Ÿ ×‘×’×“×™× ×’×“×•×œ â€“ ××“×£ ××—×“", video:YT.wardrobe, tip:"×‘×’×“×™ ×‘×™×ª / ×™×¦×™××” / ×ª×¨×•××”"},
      {key:"parents", label:"ğŸ›ï¸ ×—×“×¨ ×©×™× ×” ×”×•×¨×™× â€“ ×©×•×œ×™×•×ª", video:YT.living, tip:"×©×™×“×•×ª ×•××“×£ ××—×“"},
      {key:"playroom",label:"ğŸ® ×—×“×¨ ××©×—×§×™× â€“ ×§×•×¤×¡×” ××—×ª", video:YT.toys, tip:"×œ×¤×™ ×§×˜×’×•×¨×™×” ××—×ª"},
      {key:"bathroom",label:"ğŸš¿ ×××‘×˜×™×” â€“ ××“×£/××’×™×¨×”", video:YT.bathroom, tip:"×ª×•×§×£ ××•×¦×¨×™×"}
    ];

    /* ===================== ×©××™×¨×” ===================== */
    const KEY = "steph-org";
    const todayStr = new Date().toDateString();

    function loadState(){
      let s = JSON.parse(localStorage.getItem(KEY) || "{}");
      if(!s.date){ s = { date: todayStr, mine:[], kids:{mafal:[],maayan:[]}, weekend:{}, focus:{items:[],hideDone:false}, carry:{} }; }
      // ×™×•× ×—×“×© â†’ ××¢×‘×™×¨×™× ×œ× ×’××•×¨×™× ×œ-carry ×•××’×¨×™×œ×™× ×—×“×©×™×
      if(s.date !== todayStr){
        s.carry = {
          mine: (s.mine||[]).filter(x=>!x.done).map(x=>({id:x.id,source:"MASTER"})),
          mafal:(s.kids?.mafal||[]).filter(x=>!x.done).map(x=>({id:x.id,owner:"mafal"})),
          maayan:(s.kids?.maayan||[]).filter(x=>!x.done).map(x=>({id:x.id,owner:"maayan"}))
        };
        s.mine = []; s.kids={mafal:[],maayan:[]};
        s.date = todayStr;
      }
      return s;
    }
    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); updateStats(); }

    let state = loadState();

    /* ===================== ×¢×–×¨ ===================== */
    const byId = id => MASTER.find(t=>t.id===id) || {};
    const randPick = (arr, n) => [...arr].sort(()=>0.5-Math.random()).slice(0,n);
    function isWeekend(){ const d=new Date().getDay(); return (d===5||d===6); } // ×©×™×©×™/×©×‘×ª
    function weekIndex(){ return Math.floor(Date.now()/(7*24*60*60*1000)) % WEEKEND.length; }

    /* ===================== ×™×¦×™×¨×ª ×™×•× ===================== */
    function ensureTodayTasks(){
      // ×©×œ×™ â€“ 2 ×¨× ×“×•××œ×™×•×ª + carry
      if(state.mine.length===0){
        const carry = (state.carry?.mine||[]).map(c=>MASTER.find(m=>m.id===c.id)).filter(Boolean);
        const pool = MASTER.filter(t=>!carry.some(c=>c.id===t.id));
        const fresh = randPick(pool, Math.max(0,2-carry.length));
        state.mine = [...carry, ...fresh].map(t=>({ ...t, done:false }));
      }
      // ×‘× ×•×ª â€“ 1 ×œ×›×œ ××—×ª + carry
      for(const who of ["mafal","maayan"]){
        if(state.kids[who].length===0){
          const src = KIDS[who];
          const carry = (state.carry?.[who]||[]).map(c=>src.find(x=>x.id===c.id)).filter(Boolean);
          const pool = src.filter(t=>!carry.some(c=>c.id===t.id));
          const fresh = randPick(pool, Math.max(0,1-carry.length));
          state.kids[who] = [...carry, ...fresh].map(t=>({ ...t, done:false }));
        }
      }
      saveState();
    }

    /* ===================== ×¨× ×“×¨ ===================== */
    function taskHTML(t, group, idx){
      const done = t.done ? "done" : "";
      return `
        <div class="card p-4 ${done}">
          <div class="flex items-center justify-between mb-1">
            <h4 class="font-semibold">${t.title}</h4>
            <span class="pill">${t.time||""}</span>
          </div>
          <p class="tiny mb-2">ğŸ§­ ×˜×™×¤: ${t.tip||""}</p>
          ${t.video?`<a class="link tiny" target="_blank" href="${t.video}">ğŸ¬ ×¡×¨×˜×•×Ÿ ××•××œ×¥</a>`:""}
          <div class="mt-3 flex gap-2">
            <button class="btn btn-ghost" onclick="toggleDone('${group}',${idx})">âœ… ×‘×•×¦×¢</button>
            <button class="btn btn-ghost" onclick="skipTask('${group}',${idx})">â­ï¸ ×“×œ×’</button>
            <button class="btn btn-ghost" onclick="removeTask('${group}',${idx})">ğŸ—‘ï¸ ××—×§</button>
          </div>
        </div>
      `;
    }

    function renderAll(){
      // ×©×œ×™
      document.getElementById("mine").innerHTML = state.mine.map((t,i)=>taskHTML(t,"mine",i)).join("") || `<div class="card p-4">×”×›×•×œ × ×§×™! ğŸ‰</div>`;
      // ×‘× ×•×ª
      document.getElementById("kids-mafal").innerHTML = state.kids.mafal.map((t,i)=>taskHTML(t,"mafal",i)).join("") || `<div class="tiny">××™×Ÿ ×›×¨×’×¢</div>`;
      document.getElementById("kids-maayan").innerHTML = state.kids.maayan.map((t,i)=>taskHTML(t,"maayan",i)).join("") || `<div class="tiny">××™×Ÿ ×›×¨×’×¢</div>`;
      // ×¡×•×¤×´×©
      const wWrap = document.getElementById("weekend");
      const note = document.getElementById("weekend-note");
      if(isWeekend()){
        const idx = weekIndex();
        const area = WEEKEND[idx];
        note.textContent = `×©×‘×•×¢ ${idx+1}/${WEEKEND.length} â€“ ×¡×‘×‘ ××ª×§×“× ××•×˜×•××˜×™×ª ×›×©××¡×× ×™× ×‘×•×¦×¢`;
        const done = state.weekend?.done || false;
        wWrap.innerHTML = `
          <div class="card p-4 ${done?'done':''}">
            <div class="flex items-center justify-between mb-1">
              <h4 class="font-semibold">${area.label}</h4>
              <span class="pill">30â€“60 ×“×³</span>
            </div>
            <p class="tiny mb-2">ğŸ§­ ×˜×™×¤: ${area.tip}</p>
            <a class="link tiny" target="_blank" href="${area.video}">ğŸ¬ ×¡×¨×˜×•×Ÿ ×¢×•××§</a>
            <div class="mt-3 flex gap-2">
              <button class="btn btn-ghost" onclick="toggleWeekend()">âœ… ×‘×•×¦×¢</button>
              <button class="btn btn-ghost" onclick="skipWeekend()">â­ï¸ ×“×œ×’ ×œ×©×‘×•×¢ ×”×‘×</button>
            </div>
          </div>
        `;
      } else {
        note.textContent = "××•×¤×™×¢ ××•×˜×•××˜×™×ª ×¨×§ ×‘×©×™×©×™â€“×©×‘×ª";
        wWrap.innerHTML = `<div class="tiny">×”××ª×™× ×™ ×œ×¡×•×¤×´×© ğŸ˜Š</div>`;
      }
      updateStats();
      renderFocus();
    }

    function updateStats(){
      const all = [...state.mine, ...state.kids.mafal, ...state.kids.maayan];
      const done = all.filter(x=>x.done).length + (state.weekend?.done?1:0);
      const active = all.filter(x=>!x.done).length + (isWeekend() && !state.weekend?.done ? 1 : 0);
      const total = all.length + (isWeekend()?1:0);
      document.getElementById("stat-done").textContent = done;
      document.getElementById("stat-active").textContent = active;
      document.getElementById("stat-total").textContent = total;
    }

    /* ===== ×¤×¢×•×œ×•×ª ××©×™××” ===== */
    function toggleDone(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      ref[idx].done = !ref[idx].done;
      saveState(); renderAll();
    }
    function skipTask(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      const [t] = ref.splice(idx,1);
      ref.push(t); // ××¢×‘×™×¨ ×œ×¡×•×£
      saveState(); renderAll();
    }
    function removeTask(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      ref.splice(idx,1);
      saveState(); renderAll();
    }

    /* ===== ×¡×•×¤×´×© ===== */
    function toggleWeekend(){ state.weekend = {done: !(state.weekend?.done)}; saveState(); renderAll(); }
    function skipWeekend(){ // ××ª×§×“× ×©×‘×•×¢ ×§×“×™××” ×¢×œ ×™×“×™ ×›×ª×™×‘×” ×©×œ "×“×™×œ×’× ×•" ×¢× ×—×•×ª××ª ×©×‘×•×¢
      state.weekend = {done:false, skippedAt: Date.now()};
      // ×œ× ×‘×××ª ×¦×¨×™×š ×œ×©× ×•×ª ××™× ×“×§×¡ â€“ ×”×•× ××—×•×©×‘ ×œ×¤×™ ×©×‘×•×¢ × ×•×›×—×™. ×”×“×™×œ×•×’ ×¨×§ ×œ×©×§×˜ × ×¤×©×™.
      saveState(); renderAll();
    }

    /* ===== ×¤×•×§×•×¡ ×¦'×§-×œ×™×¡×˜ ===== */
    function renderFocus(){
      const wrap = document.getElementById("focus-list");
      const items = state.focus.items || [];
      const hide = state.focus.hideDone;
      wrap.innerHTML = items.filter(i => !(hide && i.done)).map((it,idx)=>`
        <div class="check-item ${it.done?'done':''}">
          <div class="flex-1">
            <div>${it.text}</div>
            ${it.video?`<a class="link tiny" target="_blank" href="${it.video}">ğŸ¬ ×¡×¨×˜×•×Ÿ</a>`:""}
          </div>
          <div class="flex gap-1">
            <button class="btn btn-ghost" title="×‘×•×¦×¢" onclick="focusDone(${idx})">âœ…</button>
            <button class="btn btn-ghost" title="×‘×˜×œ" onclick="focusUndo(${idx})">â†©ï¸</button>
            <button class="btn btn-ghost" title="×“×œ×’" onclick="focusSkip(${idx})">â­ï¸</button>
            <button class="btn btn-ghost" title="××—×§" onclick="focusRemove(${idx})">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join("") || `<div class="tiny">×¢×“×™×™×Ÿ ××™×Ÿ ×¦×¢×“×™×. ×”×“×‘×™×§×™ ×˜×§×¡×˜ ×•×œ×—×¦×™ â€œ×¦×•×¨/×¢×“×›×Ÿ ×¦×³×§-×œ×™×¡×˜â€.</div>`;
      document.getElementById("btn-hide-done").classList.toggle("bg-slate-200", hide);
    }

    function parseFocus(text){
      // ××–×”×” ×©×•×¨×•×ª ×¢× " - " ××• ×ª×‘×œ×™×˜×™×; ××—×œ×¥ ×’× ×œ×™× ×§×™× ×œ-YouTube ×× ×™×©
      return text.split("\n").map(l=>l.trim()).filter(Boolean).map(l=>{
        const m = l.match(/https?:\/\/\S+/);
        return { text: l.replace(m?.[0]||"","").trim(), video: m?.[0]||"", done:false };
      });
    }

    /* ===== ××™×¨×•×¢×™× ===== */
    document.getElementById("btn-new").addEventListener("click", ()=>{
      // ××¨×¢× ×Ÿ ××©×™××•×ª ×”×™×•× (×©×•××¨ ×œ× ×’××•×¨×™× ×¢"×™ carry ××•×˜×•××˜×™ ×‘×™×•× ×”×‘×)
      state.mine = []; state.kids={mafal:[],maayan:[]};
      saveState(); ensureTodayTasks(); renderAll();
    });

    document.getElementById("btn-make").addEventListener("click", ()=>{
      const txt = document.getElementById("focus-input").value.trim();
      if(!txt) return;
      const parsed = parseFocus(txt);
      // ××©×œ×‘×™× ×¢× ×”×§×™×™××™× â€“ ××” ×©×œ× ×§×™×™× × ×•×¡×£, ×§×™×™××™× × ×©××¨×™× ×‘××¦×‘×
      const existing = state.focus.items || [];
      const merged = [...existing];
      parsed.forEach(p=>{
        if(!merged.some(x=>x.text===p.text)) merged.push(p);
      });
      state.focus.items = merged;
      saveState(); renderFocus();
    });

    document.getElementById("btn-hide-done").addEventListener("click", ()=>{
      state.focus.hideDone = !state.focus.hideDone; saveState(); renderFocus();
    });
    document.getElementById("btn-show-all").addEventListener("click", ()=>{
      state.focus.hideDone = false; saveState(); renderFocus();
    });
    document.getElementById("btn-clear").addEventListener("click", ()=>{
      if(confirm("×œ× ×§×•×ª ××ª ×›×œ ×”×¦'×§-×œ×™×¡×˜?")){ state.focus.items=[]; saveState(); renderFocus(); }
    });

    // ×¤×¢×•×œ×•×ª ×¤×¨×™×˜ ×¤×•×§×•×¡
    function focusDone(i){ state.focus.items[i].done = true; saveState(); renderFocus(); }
    function focusUndo(i){ state.focus.items[i].done = false; saveState(); renderFocus(); }
    function focusSkip(i){ const [x]=state.focus.items.splice(i,1); state.focus.items.push(x); saveState(); renderFocus(); }
    function focusRemove(i){ state.focus.items.splice(i,1); saveState(); renderFocus(); }

    /* ===== ×”×¤×¢×œ×” ×¨××©×•× ×” ===== */
    ensureTodayTasks();
    renderAll();
  </script>
</body>
</html>
<!-- ×”×ª×¨××•×ª -->
<section class="card p-5 mb-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-lg font-semibold text-gray-800">ğŸ”” ×ª×–×›×•×¨×ª ×™×•××™×ª</h2>
      <p class="tiny">×”×ª×¨××” ×‘×™×Ÿ 21:00â€“22:00 ×œ×”×–×›×™×¨ ×œ×¡×™×™× ××©×™××•×ª. × ×©××¨ ×‘××›×©×™×¨.</p>
    </div>
    <div class="flex gap-2">
      <button id="btn-notify-toggle" class="btn btn-ghost">×”×¤×¢×œ ×ª×–×›×•×¨×ª</button>
      <button id="btn-notify-test" class="btn bg-purple-600 text-white hover:bg-purple-700">×‘×“×™×§×ª ×ª×–×›×•×¨×ª</button>
    </div>
  </div>
  <p id="notify-status" class="tiny mt-2"></p>
</section>
/* ===================== ×”×ª×¨××•×ª ×™×•××™×•×ª ===================== */
const NOTIFY_KEY = "steph-org-notify";   // ×©××™×¨×ª ××¦×‘ ×”×”×ª×¨××”
const statusEl = () => document.getElementById("notify-status");
const toggleBtn = () => document.getElementById("btn-notify-toggle");

function updateNotifyUI(){
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  toggleBtn().textContent = on ? "×›×‘×” ×ª×–×›×•×¨×ª" : "×”×¤×¢×œ ×ª×–×›×•×¨×ª";
  statusEl().textContent = on
    ? "×”×ª×–×›×•×¨×ª ×¤×¢×™×œ×”. ×”×”×ª×¨××” ×ª×•×¤×™×¢ ×›×œ ×™×•× ×‘×™×Ÿ 21:00â€“22:00."
    : "×”×ª×–×›×•×¨×ª ×›×‘×•×™×”.";
}

async function enableNotifications(){
  if(!("Notification" in window)) { alert("×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×‘×”×ª×¨××•×ª"); return false; }
  let perm = Notification.permission;
  if(perm === "default") perm = await Notification.requestPermission();
  if(perm !== "granted"){ alert("×›×“×™ ×œ×§×‘×œ ×”×ª×¨××•×ª ×¦×¨×™×š ×œ××©×¨ ×‘×“×¤×“×¤×Ÿ"); return false; }
  localStorage.setItem(NOTIFY_KEY, "true");
  scheduleDailyNotification();
  updateNotifyUI();
  return true;
}

function disableNotifications(){
  localStorage.setItem(NOTIFY_KEY, "false");
  clearExistingTimers();
  updateNotifyUI();
}

/* × ×™×”×•×œ ×˜×™×™××¨×™× */
let notifyTimerId = null;
function clearExistingTimers(){ if(notifyTimerId){ clearTimeout(notifyTimerId); notifyTimerId=null; } }

/* ×ª×–××•×Ÿ: ×× ×¢×›×©×™×• 21:00â€“22:00 â†’ × ×©×œ×— ×ª×•×š ×“×§×” (×“××•). ××—×¨×ª â†’ ×œ×ª×–××Ÿ ×œÖ¾21:00 ×”×‘× */
function scheduleDailyNotification(){
  clearExistingTimers();
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  if(!on) return;

  const now = new Date();
  const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 21, 0, 0);
  const end   = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 22, 0, 0);

  let msUntil;
  if(now >= start && now <= end){
    msUntil = 60*1000; // ×“×§×” â€“ ×“××•
  } else {
    const next = (now < start) ? start : new Date(start.getTime()+24*60*60*1000);
    msUntil = next.getTime() - now.getTime();
  }

  notifyTimerId = setTimeout(()=> {
    fireNotification();
    // ×§×•×‘×¢×™× ×©×•×‘ ×œ×¢×•×“ 24 ×©×¢×•×ª
    notifyTimerId = setTimeout(fireNotification, 24*60*60*1000);
  }, msUntil);
}

function fireNotification(){
  try{
    if("Notification" in window && Notification.permission==="granted"){
      new Notification("×–××Ÿ ×œ× ×™×§×™×•×Ÿ! ğŸ ", {
        body: "×”×’×™×¢ ×”×–××Ÿ ×œ××©×™××•×ª ×”×‘×™×ª ×©×œ×š",
      });
    }
    // ×’× ×¤×•×¤Ö¾××¤ ×§×˜×Ÿ ×‘×ª×•×š ×”××ª×¨
    try{
      const el = document.createElement("div");
      el.textContent = "×–××Ÿ ×œ× ×™×§×™×•×Ÿ! ×”×’×™×¢ ×”×–××Ÿ ×œ××©×™××•×ª ×”×‘×™×ª ×©×œ×š ğŸ§½";
      el.style.cssText = "position:fixed;top:16px;left:16px;right:16px;background:#7c3aed;color:#fff;padding:12px 14px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.2);z-index:9999;text-align:center";
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 4000);
    }catch(e){}
  }catch(e){}
}

/* ××™×¨×•×¢×™× ×œ×›×¤×ª×•×¨×™× */
document.getElementById("btn-notify-test").addEventListener("click", fireNotification);
document.getElementById("btn-notify-toggle").addEventListener("click", async ()=>{
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  if(on) disableNotifications(); else await enableNotifications();
});

/* ××ª×—×•×œ ×‘×¢×ª ×˜×¢×™× ×ª ×”×“×£ */
updateNotifyUI();
if(JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false")) scheduleDailyNotification();


