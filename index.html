<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ארגון וסדר – הבית שלי</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Heebo',sans-serif;background:linear-gradient(180deg,#fff7ff,#f7f2ff);}
    .card{background:#fff;border-radius:18px;box-shadow:0 12px 30px rgba(0,0,0,.08);}
    .badge{font-size:.8rem;background:#f1e8ff;color:#6b21a8;border-radius:999px;padding:.25rem .6rem}
    .btn{border-radius:12px;padding:.6rem 1rem}
    .btn-ghost{background:#f6f6fb}
    .tiny{font-size:.9rem;color:#6b7280}
    .link{color:#6d28d9;text-decoration:underline}
  </style>
</head>
<body class="min-h-screen">
  <header class="max-w-3xl mx-auto px-4 pt-6">
    <h1 class="text-3xl font-bold text-gray-800">🏠 ארגון וסדר</h1>
    <p class="tiny mt-1">משימות קצרות לימים עמוסים + משימה גדולה לסופ״ש. נשמר אוטומטית.</p>
  </header>

  <main class="max-w-3xl mx-auto px-4 pb-24 space-y-6">

    <!-- התראות -->
    <section class="card p-5">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-gray-800">🔔 תזכורת יומית</h2>
          <p class="tiny">התראה בין 21:00–22:00 להזכיר לסיים משימות. נשמר במכשיר.</p>
        </div>
        <div class="flex gap-2">
          <button id="btn-notify-toggle" class="btn btn-ghost">הפעל תזכורת</button>
          <button id="btn-notify-test" class="btn bg-purple-600 text-white hover:bg-purple-700">בדיקת תזכורת</button>
        </div>
      </div>
      <p id="notify-status" class="tiny mt-2"></p>
    </section>

    <!-- משימות יומיות -->
    <section class="card p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-gray-800">🎯 פוקוס יומי – 3 משימות קלות</h2>
        <span id="today-badge" class="badge"></span>
      </div>
      <div id="daily-list" class="mt-4 grid gap-3"></div>
      <p class="tiny mt-3">טיפ: 10 דק׳ לכל משימה. אפשר לשתף עם מפל (10) ומעיין (8) 😇</p>
    </section>

    <!-- מורכבות לסופ"ש -->
    <section class="card p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-gray-800">🧱 מורכבות לסופ״ש</h2>
        <span class="badge">30–60 ד׳</span>
      </div>
      <p class="tiny mt-1">בימי שישי–שבת תופיע כאן משימה אחת מסדרות הארגון.</p>
      <div id="weekly-card" class="mt-4"></div>
    </section>

    <!-- תכנית ממוקדת לאזור (הדבקה → צ'ק־ליסט) -->
    <section class="card p-5" id="area-plan">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-bold text-gray-800">📌 תכנית ממוקדת לאזור</h2>
        <button id="btn-show-all" class="btn btn-ghost text-sm">הצג הכול 👀</button>
      </div>
      <p class="tiny mt-1">הדביקי כאן צעדים – כל שורה הופכת לסעיף:</p>
      <textarea id="steps-input" rows="5" class="w-full mt-3 rounded-xl border border-gray-200 p-3 focus:outline-none focus:ring-2 focus:ring-purple-400" placeholder="1. לאסוף נעליים&#10;2. לרוקן את השולחן&#10;3. למיין כביסה&#10;..."></textarea>
      <div class="flex flex-wrap gap-2 mt-3">
        <button id="btn-build-checklist" class="btn bg-purple-600 text-white hover:bg-purple-700">צור/עדכן צ׳ק־ליסט ✅</button>
        <button id="btn-hide-done" class="btn btn-ghost">הסתר שהושלם 🧹</button>
        <button id="btn-clear" class="btn btn-ghost">נקה צ׳ק־ליסט 🗑️</button>
      </div>
      <div id="checklist" class="mt-4 space-y-2"></div>
      <p class="tiny mt-3">טיפ: שלחי לי תמונות של אזור מסוים ואני אייצר לך כאן תכנית מדוייקת עם צעדים קטנים.</p>
    </section>

    <footer class="text-center tiny text-gray-500">
      נבנה ביחד עם סטפני 💜 – נשמר מקומית בדפדפן.
    </footer>
  </main>

  <script>
  /* ========== נתוני משימות (עם קישורי וידאו לפי נושא) ========== */
  const dailyTasks = [
    { id:'sofa', icon:'🛋️', title:'ספה – איסוף ומיון', time:'10 ד׳', tip:'להוריד הכול מהספה, למיין נקי/מלוכלך', video:'https://www.youtube.com/results?search_query=%D7%A1%D7%93%D7%A8+%D7%A1%D7%9C%D7%95%D7%9F+%D7%A0%D7%99%D7%A7%D7%99%D7%95%D7%9F+%D7%A1%D7%A4%D7%94' },
    { id:'coffee', icon:'☕', title:'שולחן סלון – פינוי מלא', time:'10 ד׳', tip:'לפנות לגמרי ולנגב עם מגבון', video:'https://www.youtube.com/results?search_query=%D7%A1%D7%93%D7%A8+%D7%A9%D7%95%D7%9C%D7%97%D7%9F+%D7%A1%D7%9C%D7%95%D7%9F' },
    { id:'shoes', icon:'👟', title:'נעליים בכניסה', time:'5 ד׳', tip:'לאסוף להחזיר לארון/סל', video:'https://www.youtube.com/results?search_query=%D7%90%D7%A8%D7%92%D7%95%D7%9F+%D7%A0%D7%A2%D7%9C%D7%99%D7%99%D7%9D' },
    { id:'trash', icon:'🗑️', title:'מיני-אשפה מהירה', time:'5 ד׳', tip:'לסיבוב מהיר עם שקית, רק זבל גלוי', video:'https://www.youtube.com/results?search_query=%D7%98%D7%99%D7%A4%D7%99%D7%9D+%D7%9C%D7%A0%D7%99%D7%A7%D7%99%D7%95%D7%9F+%D7%9E%D7%94%D7%99%D7%A8' },
    { id:'surfaces', icon:'🧽', title:'משטחי מטבח – ניגוב', time:'10 ד׳', tip:'לפנות 3 פריטים, לנגב, להחזיר מסודר', video:'https://www.youtube.com/results?search_query=%D7%90%D7%A8%D7%92%D7%95%D7%9F+%D7%9E%D7%98%D7%91%D7%97+%D7%9E%D7%94%D7%99%D7%A8' },
    { id:'desk', icon:'💻', title:'שולחן עבודה – 10 פריטים', time:'10 ד׳', tip:'לסדר/לזרוק 10 פריטים בלבד', video:'https://www.youtube.com/results?search_query=%D7%A1%D7%93%D7%A8+%D7%A9%D7%95%D7%9C%D7%97%D7%9F+%D7%A2%D7%91%D7%95%D7%93%D7%94' },
    { id:'bath-sink', icon:'🚿', title:'כיור אמבטיה', time:'5 ד׳', tip:'שטיפה/מגב מהירה', video:'https://www.youtube.com/results?search_query=%D7%A0%D7%99%D7%A7%D7%95%D7%99+%D7%9B%D7%99%D7%95%D7%A8+%D7%90%D7%9E%D7%91%D7%98%D7%99%D7%94' },
    { id:'laundry', icon:'🧺', title:'כביסה – סבב אחד', time:'5 ד׳ הוצאה', tip:'להכניס/להוציא סבב אחד בלבד', video:'https://www.youtube.com/results?search_query=%D7%9E%D7%99%D7%95%D7%9F+%D7%9B%D7%91%D7%99%D7%A1%D7%94+%D7%9E%D7%94%D7%99%D7%A8' },
  ];

  const weekendTasks = [
    { id:'wardrobe', icon:'👗', title:'סידור ארון בגדים – מדף אחד', tip:'רק מדף/מגירה אחת. מיון: לשמור / לתרום / לזרוק', video:'https://www.youtube.com/results?search_query=%D7%A1%D7%99%D7%93%D7%95%D7%A8+%D7%90%D7%A8%D7%95%D7%9F+%D7%91%D7%92%D7%93%D7%99%D7%9D' },
    { id:'kitchen-cab', icon:'🗄️', title:'ארון מטבח – מדף תבלינים', tip:'להוציא הכול, לנגב, להחזיר לפי קטגוריות', video:'https://www.youtube.com/results?search_query=%D7%90%D7%A8%D7%92%D7%95%D7%9F+%D7%90%D7%A8%D7%95%D7%9F+%D7%9E%D7%98%D7%91%D7%97' },
    { id:'utility', icon:'🧰', title:'חדר שירות – סל אחסון אחד', tip:'לבחור סל/פינה אחת ולסדר עד סיום', video:'https://www.youtube.com/results?search_query=%D7%90%D7%A8%D7%92%D7%95%D7%9F+%D7%97%D7%93%D7%A8+%D7%A9%D7%99%D7%A8%D7%95%D7%AA' },
    { id:'kids-room', icon:'🧸', title:'חדר משחקים – מדף צעצועים', tip:'קופסה לצעצועים חסרים, קופסה לתרומה', video:'https://www.youtube.com/results?search_query=%D7%90%D7%A8%D7%92%D7%95%D7%9F+%D7%97%D7%93%D7%A8+%D7%9E%D7%A9%D7%97%D7%A7%D7%99%D7%9D' },
    { id:'parents-shelves', icon:'🛏️', title:'חדר הורים – שידות ומדף אחד', tip:'לסיים מדף/שידה עד נקי ומסודר', video:'https://www.youtube.com/results?search_query=%D7%A1%D7%93%D7%A8+%D7%97%D7%93%D7%A8+%D7%A9%D7%99%D7%A0%D7%94' },
  ];

  /* ========== עזר: בחירה יציבה לפי תאריך ========== */
  function seedPick(arr, count){
    const d = new Date(); const seed = d.getFullYear()*10000+(d.getMonth()+1)*100+d.getDate();
    const out = []; let s = seed;
    const used = new Set();
    while(out.length<count && used.size<arr.length){
      s = (s * 1664525 + 1013904223) % 4294967296;
      const idx = s % arr.length;
      if(!used.has(idx)){ used.add(idx); out.push(arr[idx]); }
    }
    return out;
  }

  /* ========== משימות יומיות ========== */
  const DAILY_DONE_KEY = "daily_done_v1";
  function renderDaily(){
    document.getElementById('today-badge').textContent = new Date().toLocaleDateString('he-IL', {weekday:'long', day:'2-digit', month:'2-digit'});
    const container = document.getElementById('daily-list');
    const pick = seedPick(dailyTasks, 3);
    const done = JSON.parse(localStorage.getItem(DAILY_DONE_KEY) || "{}");
    container.innerHTML = pick.map(t => `
      <div class="p-4 rounded-xl border border-gray-100 flex items-start justify-between gap-3">
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <span class="text-2xl">${t.icon}</span>
            <h3 class="font-semibold text-gray-800">${t.title}</h3>
            <span class="badge">${t.time}</span>
          </div>
          <p class="tiny mt-1">${t.tip}</p>
          <a class="link tiny" target="_blank" href="${t.video}">🎥 סרטון טיפים בנושא</a>
        </div>
        <button data-id="${t.id}" class="btn ${done[t.id]?'bg-green-600 text-white':'btn-ghost'} toggle-done">
          ${done[t.id]?'בוצע ✅':'סמן בוצע'}
        </button>
      </div>
    `).join('');
    container.querySelectorAll('.toggle-done').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-id');
        const map = JSON.parse(localStorage.getItem(DAILY_DONE_KEY) || "{}");
        map[id] = !map[id];
        localStorage.setItem(DAILY_DONE_KEY, JSON.stringify(map));
        renderDaily();
      });
    });
  }

  /* ========== מורכבות לסופ"ש ========== */
  const WEEKLY_DONE_KEY = "weekly_done_v1";
  function renderWeekly(){
    const day = new Date().getDay(); // 5=Fri, 6=Sat
    const wrap = document.getElementById('weekly-card');
    if(day!==5 && day!==6){
      wrap.innerHTML = `<p class="tiny">כשתגיעי לסופ״ש, תופיע כאן משימה אחת גדולה 🙂</p>`;
      return;
    }
    const [task] = seedPick(weekendTasks,1);
    const done = JSON.parse(localStorage.getItem(WEEKLY_DONE_KEY) || "{}");
    wrap.innerHTML = `
      <div class="p-4 rounded-xl border border-gray-100 flex items-start justify-between gap-3">
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <span class="text-2xl">${task.icon}</span>
            <h3 class="font-semibold text-gray-800">${task.title}</h3>
          </div>
          <p class="tiny mt-1">טיפ: ${task.tip}</p>
          <a class="link tiny" target="_blank" href="${task.video}">🎬 סרטון השראה/שיטה</a>
        </div>
        <div class="flex flex-col gap-2">
          <button id="btn-weekly-done" class="btn ${done[task.id]?'bg-green-600 text-white':'btn-ghost'}">${done[task.id]?'בוצע ✅':'בוצע'}</button>
          <button id="btn-skip-week" class="btn btn-ghost">דלג לשבוע הבא ⏭️</button>
        </div>
      </div>
    `;
    document.getElementById('btn-weekly-done').onclick=()=>{
      const map = JSON.parse(localStorage.getItem(WEEKLY_DONE_KEY) || "{}");
      map[task.id]=!map[task.id]; localStorage.setItem(WEEKLY_DONE_KEY,JSON.stringify(map)); renderWeekly();
    };
    document.getElementById('btn-skip-week').onclick=()=>{
      // מסמן כאילו בוצע כדי להחליף בשבוע הבא
      const map = JSON.parse(localStorage.getItem(WEEKLY_DONE_KEY) || "{}");
      map[task.id]=true; localStorage.setItem(WEEKLY_DONE_KEY,JSON.stringify(map));
      location.reload();
    };
  }

  /* ========== תכנית ממוקדת לאזור – צ׳ק־ליסט ========== */
  const AREA_KEY = "area_checklist_v2";
  function buildChecklistFromText(){
    const text = document.getElementById('steps-input').value;
    const items = text.split('\n')
      .map(s=>s.trim()).filter(Boolean)
      .map((t,idx)=>({ id:'i'+idx, text:t, done:false }));
    localStorage.setItem(AREA_KEY, JSON.stringify(items));
    renderChecklist();
  }
  function renderChecklist(showAll=false){
    const container = document.getElementById('checklist');
    const data = JSON.parse(localStorage.getItem(AREA_KEY) || "[]");
    const visible = showAll ? data : data.filter(x=>!x.done);
    container.innerHTML = visible.length ? visible.map(it=>`
      <label class="flex items-center gap-3 p-3 rounded-xl border border-gray-100">
        <input type="checkbox" ${it.done?'checked':''} data-id="${it.id}" class="h-5 w-5 rounded">
        <span class="${it.done?'line-through text-gray-400':''}">${it.text}</span>
      </label>
    `).join('') : `<p class="tiny">עדיין אין צעדים. הדביקי טקסט ולחצי “צור/עדכן צ׳ק־ליסט”.</p>`;
    container.querySelectorAll('input[type=checkbox]').forEach(cb=>{
      cb.addEventListener('change',()=>{
        const id = cb.getAttribute('data-id');
        const list = JSON.parse(localStorage.getItem(AREA_KEY) || "[]");
        const it = list.find(x=>x.id===id);
        if(it){ it.done = cb.checked; localStorage.setItem(AREA_KEY, JSON.stringify(list)); renderChecklist(showAll); }
      });
    });
  }
  document.getElementById('btn-build-checklist').onclick = buildChecklistFromText;
  document.getElementById('btn-hide-done').onclick = ()=> renderChecklist(false);
  document.getElementById('btn-show-all').onclick = ()=> renderChecklist(true);
  document.getElementById('btn-clear').onclick = ()=>{
    if(confirm('לנקות את הצ׳ק־ליסט?')){ localStorage.removeItem(AREA_KEY); renderChecklist(true); }
  };

  /* ========== התראות יומיות (מתוקן) ========== */
  const NOTIFY_KEY = "daily_notify";
  function updateNotifyUI() {
    const statusEl = document.getElementById("notify-status");
    const isOn = JSON.parse(localStorage.getItem(NOTIFY_KEY) || "false");
    if (statusEl) statusEl.textContent = isOn ? "התזכורת פעילה" : "התזכורת כבויה";
    const btn = document.getElementById("btn-notify-toggle");
    if (btn) btn.textContent = isOn ? "כבה תזכורת" : "הפעל תזכורת";
  }
  async function enableNotifications() {
    if (!("Notification" in window)) { alert("הדפדפן לא תומך בהתראות"); return; }
    let perm = Notification.permission;
    if (perm === "default") perm = await Notification.requestPermission();
    if (perm !== "granted") { alert("צריך לאשר קבלת התראות בדפדפן"); return; }
    localStorage.setItem(NOTIFY_KEY, "true");
    scheduleDailyNotification();
    updateNotifyUI();
  }
  function disableNotifications() {
    localStorage.setItem(NOTIFY_KEY, "false");
    clearExistingTimers(); updateNotifyUI();
  }
  let notifyTimerId = null;
  function clearExistingTimers(){ if (notifyTimerId) clearTimeout(notifyTimerId); notifyTimerId=null; }
  function scheduleDailyNotification(){
    clearExistingTimers();
    const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false"); if(!on) return;
    const now = new Date();
    const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 21, 0, 0);
    const end   = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 22, 0, 0);
    let msUntil = start - now;
    if (msUntil < 0) {
      msUntil = end - now;
      if (msUntil < 0) msUntil = start.getTime()+24*60*60*1000 - now.getTime(); // למחר
    }
    notifyTimerId = setTimeout(()=>{ fireNotification(); scheduleDailyNotification(); }, msUntil);
  }
  function fireNotification(){
    try{
      if("Notification" in window && Notification.permission==="granted"){
        new Notification("זמן לניקיון! 🏠",{ body:"הגיע הזמן למשימות הבית שלך" });
      }
      const el = document.createElement("div");
      el.textContent = "זמן לניקיון! הגיע הזמן למשימות 🧽";
      el.style.cssText="position:fixed;top:16px;left:16px;right:16px;background:#7c3aed;color:#fff;padding:12px 14px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.2);z-index:9999;text-align:center";
      document.body.appendChild(el); setTimeout(()=>el.remove(), 3500);
    }catch(e){}
  }
  document.getElementById("btn-notify-test").addEventListener("click", fireNotification);
  document.getElementById("btn-notify-toggle").addEventListener("click", ()=>{
    const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
    if(on) disableNotifications(); else enableNotifications();
  });

  /* ========== אתחול ========== */
  document.addEventListener('DOMContentLoaded', ()=>{
    renderDaily(); renderWeekly(); renderChecklist(true);
    updateNotifyUI(); if(JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false")) scheduleDailyNotification();
  });
  </script>
</body>
</html>
