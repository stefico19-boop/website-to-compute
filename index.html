<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ארגון וסדר – סטפני</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:"Heebo",sans-serif}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 28px rgba(0,0,0,.08)}
    .pill{background:#f1f5f9;border-radius:999px;padding:.25rem .6rem;font-size:.8rem}
    .done{opacity:.6;text-decoration:line-through}
    .btn{border-radius:10px;padding:.55rem .9rem}
    .btn-ghost{background:#f8fafc}
    .check-item{display:flex;gap:.5rem;justify-content:space-between;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:.6rem .75rem;margin:.35rem 0}
    .tiny{font-size:.82rem;color:#64748b}
    a.link{color:#7c3aed;text-decoration:underline}
  </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
  <div class="max-w-5xl mx-auto p-5 md:p-10">
    <header class="text-center mb-6">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-800">🏠 ארגון וסדר</h1>
      <p class="text-gray-600">יומי + בנות + מורכבות סופ״ש + תכנית ממוקדת</p>
    </header>

    <!-- סטטוס -->
    <section class="card p-5 mb-6">
      <div class="grid grid-cols-3 gap-3 text-center">
        <div class="bg-green-50 rounded-lg p-3">
          <div id="stat-done" class="text-2xl font-bold text-green-600">0</div>
          <div class="text-sm text-green-700">הושלמו היום</div>
        </div>
        <div class="bg-blue-50 rounded-lg p-3">
          <div id="stat-active" class="text-2xl font-bold text-blue-600">0</div>
          <div class="text-sm text-blue-700">פעילים עכשיו</div>
        </div>
        <div class="bg-purple-50 rounded-lg p-3">
          <div id="stat-total" class="text-2xl font-bold text-purple-600">0</div>
          <div class="text-sm text-purple-700">סה״כ היום</div>
        </div>
      </div>
    </section>

    <!-- משימות יומיות -->
    <section class="mb-6">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-xl font-semibold text-gray-800">המשימות שלי היום</h2>
        <button id="btn-new" class="btn bg-blue-600 text-white hover:bg-blue-700">🔄 משימות חדשות</button>
      </div>
      <div id="mine" class="grid md:grid-cols-2 gap-4"></div>
    </section>

    <!-- בנות -->
    <section class="mb-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">👧 משימות לבנות</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-bold">מפל (10)</h3>
            <span class="pill">קליל</span>
          </div>
          <div id="kids-mafal" class="mt-2"></div>
        </div>
        <div class="card p-4">
          <div class="flex items-center justify-between">
            <h3 class="font-bold">מעיין (8)</h3>
            <span class="pill">קליל</span>
          </div>
          <div id="kids-maayan" class="mt-2"></div>
        </div>
      </div>
    </section>

    <!-- סופ״ש מורכב -->
    <section class="mb-6 card p-5">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-gray-800">🟣 משימות מורכבות לסופ״ש</h2>
        <span id="weekend-note" class="tiny"></span>
      </div>
      <div id="weekend" class="mt-2"></div>
    </section>

    <!-- תכנית ממוקדת -->
    <section class="mb-8 card p-5">
      <h2 class="text-xl font-semibold text-gray-800 mb-2">🧭 תכנית ממוקדת לאזור</h2>
      <textarea id="focus-input" rows="5" class="w-full p-3 border rounded-lg mb-3" placeholder="הדביקי כאן צעדים — כל שורה צעד"></textarea>
      <div class="flex flex-wrap gap-2 mb-3">
        <button id="btn-make" class="btn bg-purple-600 text-white hover:bg-purple-700">✅ צור/עדכן צ׳ק-ליסט</button>
        <button id="btn-hide-done" class="btn btn-ghost">🧹 הסתר שהושלמו</button>
        <button id="btn-show-all" class="btn btn-ghost">👀 הצג הכול</button>
        <button id="btn-clear" class="btn btn-ghost">🗑️ נקה צ׳ק-ליסט</button>
      </div>
      <div id="focus-list"></div>
      <p class="tiny mt-2">טיפ: שתפי כאן צילום אזור ואני אכין לך תכנית מודבקת מוכנה עם צעדים.</p>
    </section>

    <footer class="text-center text-sm text-gray-500 pb-10">
      נשמר אוטומטית במכשיר (localStorage). לכל אחת הדפדוף שלה 💾
    </footer>
  </div>

  <script>
    /* ===================== נתונים ===================== */
    const YT = {
      kitchen: "https://youtu.be/3Xnu3MpnV-g",
      konmari: "https://youtu.be/-2gHqY7cA6Y",
      living: "https://youtu.be/_h1Q3BfEzyI",
      entry: "https://youtu.be/1oYw4yQ8u7A",
      toys: "https://youtu.be/WYyPjW7OVoA",
      wardrobe: "https://youtu.be/6m1r1N2A8YQ",
      bathroom: "https://youtu.be/5HqgYQqS9Ow",
      laundry: "https://youtu.be/k5yJw0oM8vE"
    };

    const MASTER = [
      { id:"sink",     title:"שטיפת כלים בסיסית + כיור", time:"10–15 ד׳", tip:"להתחיל מדברים גדולים → משרים → קטנים", video:YT.kitchen },
      { id:"counters", title:"ניקוי משטח מטבח",          time:"8–10 ד׳",  tip:"שמאל→ימין סיבוב אחד, בלי לפתוח ארונות", video:YT.kitchen },
      { id:"living",   title:"סידור סלון נראה לעין",      time:"7–10 ד׳",  tip:"קופסת איסוף אחת, לא מחליטות עכשיו", video:YT.living },
      { id:"entry",    title:"כניסה: נעליים + מעילים",    time:"5–8 ד׳",   tip:"זוג אחד לאדם ליד הדלת, השאר לארון", video:YT.entry },
      { id:"bath",     title:"ניגוב מהיר אמבטיה",         time:"8–12 ד׳",  tip:"ברז/כיור/אסלה – מעגל אחד", video:YT.bathroom },
      { id:"desk",     title:"שולחן עבודה נקי לעין",      time:"5–8 ד׳",   tip:"לשים הכול לקופסת 'תלוי החלטה'", video:YT.konmari }
    ];

    // לילדות – קלות
    const KIDS = {
      mafal: [
        {id:"m1", title:"📚 להכין תיק למחר", time:"5 ד׳", tip:"רשימת שיעורים על השולחן", video:YT.living},
        {id:"m2", title:"🧦 להביא כביסה לסל", time:"3 ד׳", tip:"סיבוב מהיר חדר→סל כביסה", video:YT.laundry},
        {id:"m3", title:"🧸 לסדר 10 צעצועים", time:"5 ד׳", tip:"טיימר 5 ד׳ – עושים משחק!", video:YT.toys},
        {id:"m4", title:"🍽️ לעזור לערוך שולחן", time:"5 ד׳", tip:"מפיות/סכו״ם בלבד", video:YT.kitchen}
      ],
      maayan: [
        {id:"y1", title:"🧸 לסדר 10 צעצועים", time:"5 ד׳", tip:"טיימר 5 ד׳ – עושים משחק!", video:YT.toys},
        {id:"y2", title:"🧦 להביא כביסה לסל", time:"3 ד׳", tip:"תחרות מי אוספת יותר", video:YT.laundry},
        {id:"y3", title:"🥤 לאסוף בקבוקים/כוסות בסלון", time:"4 ד׳", tip:"טריי/מגש אחד", video:YT.living},
        {id:"y4", title:"🥿 לסדר נעליים בכניסה", time:"4 ד׳", tip:"זוג אחד על המדף", video:YT.entry}
      ]
    };

    // אזורי סופ״ש לפי שבוע
    const WEEKEND = [
      {key:"kitchen", label:"🍳 סידור ארונות מטבח (מדף אחד מלא)", video:YT.kitchen, tip:"מדף אחד בלבד! לרוקן→למיין→להחזיר"},
      {key:"laundry", label:"🧺 ארגון חדר שירות", video:YT.laundry, tip:"סל כביסה/חומרי ניקוי – קופסאות"},
      {key:"wardrobe",label:"👗 ארון בגדים גדול – מדף אחד", video:YT.wardrobe, tip:"בגדי בית / יציאה / תרומה"},
      {key:"parents", label:"🛏️ חדר שינה הורים – שוליות", video:YT.living, tip:"שידות ומדף אחד"},
      {key:"playroom",label:"🎮 חדר משחקים – קופסה אחת", video:YT.toys, tip:"לפי קטגוריה אחת"},
      {key:"bathroom",label:"🚿 אמבטיה – מדף/מגירה", video:YT.bathroom, tip:"תוקף מוצרים"}
    ];

    /* ===================== שמירה ===================== */
    const KEY = "steph-org";
    const todayStr = new Date().toDateString();

    function loadState(){
      let s = JSON.parse(localStorage.getItem(KEY) || "{}");
      if(!s.date){ s = { date: todayStr, mine:[], kids:{mafal:[],maayan:[]}, weekend:{}, focus:{items:[],hideDone:false}, carry:{} }; }
      // יום חדש → מעבירים לא גמורים ל-carry ומגרילים חדשים
      if(s.date !== todayStr){
        s.carry = {
          mine: (s.mine||[]).filter(x=>!x.done).map(x=>({id:x.id,source:"MASTER"})),
          mafal:(s.kids?.mafal||[]).filter(x=>!x.done).map(x=>({id:x.id,owner:"mafal"})),
          maayan:(s.kids?.maayan||[]).filter(x=>!x.done).map(x=>({id:x.id,owner:"maayan"}))
        };
        s.mine = []; s.kids={mafal:[],maayan:[]};
        s.date = todayStr;
      }
      return s;
    }
    function saveState(){ localStorage.setItem(KEY, JSON.stringify(state)); updateStats(); }

    let state = loadState();

    /* ===================== עזר ===================== */
    const byId = id => MASTER.find(t=>t.id===id) || {};
    const randPick = (arr, n) => [...arr].sort(()=>0.5-Math.random()).slice(0,n);
    function isWeekend(){ const d=new Date().getDay(); return (d===5||d===6); } // שישי/שבת
    function weekIndex(){ return Math.floor(Date.now()/(7*24*60*60*1000)) % WEEKEND.length; }

    /* ===================== יצירת יום ===================== */
    function ensureTodayTasks(){
      // שלי – 2 רנדומליות + carry
      if(state.mine.length===0){
        const carry = (state.carry?.mine||[]).map(c=>MASTER.find(m=>m.id===c.id)).filter(Boolean);
        const pool = MASTER.filter(t=>!carry.some(c=>c.id===t.id));
        const fresh = randPick(pool, Math.max(0,2-carry.length));
        state.mine = [...carry, ...fresh].map(t=>({ ...t, done:false }));
      }
      // בנות – 1 לכל אחת + carry
      for(const who of ["mafal","maayan"]){
        if(state.kids[who].length===0){
          const src = KIDS[who];
          const carry = (state.carry?.[who]||[]).map(c=>src.find(x=>x.id===c.id)).filter(Boolean);
          const pool = src.filter(t=>!carry.some(c=>c.id===t.id));
          const fresh = randPick(pool, Math.max(0,1-carry.length));
          state.kids[who] = [...carry, ...fresh].map(t=>({ ...t, done:false }));
        }
      }
      saveState();
    }

    /* ===================== רנדר ===================== */
    function taskHTML(t, group, idx){
      const done = t.done ? "done" : "";
      return `
        <div class="card p-4 ${done}">
          <div class="flex items-center justify-between mb-1">
            <h4 class="font-semibold">${t.title}</h4>
            <span class="pill">${t.time||""}</span>
          </div>
          <p class="tiny mb-2">🧭 טיפ: ${t.tip||""}</p>
          ${t.video?`<a class="link tiny" target="_blank" href="${t.video}">🎬 סרטון מומלץ</a>`:""}
          <div class="mt-3 flex gap-2">
            <button class="btn btn-ghost" onclick="toggleDone('${group}',${idx})">✅ בוצע</button>
            <button class="btn btn-ghost" onclick="skipTask('${group}',${idx})">⏭️ דלג</button>
            <button class="btn btn-ghost" onclick="removeTask('${group}',${idx})">🗑️ מחק</button>
          </div>
        </div>
      `;
    }

    function renderAll(){
      // שלי
      document.getElementById("mine").innerHTML = state.mine.map((t,i)=>taskHTML(t,"mine",i)).join("") || `<div class="card p-4">הכול נקי! 🎉</div>`;
      // בנות
      document.getElementById("kids-mafal").innerHTML = state.kids.mafal.map((t,i)=>taskHTML(t,"mafal",i)).join("") || `<div class="tiny">אין כרגע</div>`;
      document.getElementById("kids-maayan").innerHTML = state.kids.maayan.map((t,i)=>taskHTML(t,"maayan",i)).join("") || `<div class="tiny">אין כרגע</div>`;
      // סופ״ש
      const wWrap = document.getElementById("weekend");
      const note = document.getElementById("weekend-note");
      if(isWeekend()){
        const idx = weekIndex();
        const area = WEEKEND[idx];
        note.textContent = `שבוע ${idx+1}/${WEEKEND.length} – סבב מתקדם אוטומטית כשמסמנים בוצע`;
        const done = state.weekend?.done || false;
        wWrap.innerHTML = `
          <div class="card p-4 ${done?'done':''}">
            <div class="flex items-center justify-between mb-1">
              <h4 class="font-semibold">${area.label}</h4>
              <span class="pill">30–60 ד׳</span>
            </div>
            <p class="tiny mb-2">🧭 טיפ: ${area.tip}</p>
            <a class="link tiny" target="_blank" href="${area.video}">🎬 סרטון עומק</a>
            <div class="mt-3 flex gap-2">
              <button class="btn btn-ghost" onclick="toggleWeekend()">✅ בוצע</button>
              <button class="btn btn-ghost" onclick="skipWeekend()">⏭️ דלג לשבוע הבא</button>
            </div>
          </div>
        `;
      } else {
        note.textContent = "מופיע אוטומטית רק בשישי–שבת";
        wWrap.innerHTML = `<div class="tiny">המתיני לסופ״ש 😊</div>`;
      }
      updateStats();
      renderFocus();
    }

    function updateStats(){
      const all = [...state.mine, ...state.kids.mafal, ...state.kids.maayan];
      const done = all.filter(x=>x.done).length + (state.weekend?.done?1:0);
      const active = all.filter(x=>!x.done).length + (isWeekend() && !state.weekend?.done ? 1 : 0);
      const total = all.length + (isWeekend()?1:0);
      document.getElementById("stat-done").textContent = done;
      document.getElementById("stat-active").textContent = active;
      document.getElementById("stat-total").textContent = total;
    }

    /* ===== פעולות משימה ===== */
    function toggleDone(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      ref[idx].done = !ref[idx].done;
      saveState(); renderAll();
    }
    function skipTask(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      const [t] = ref.splice(idx,1);
      ref.push(t); // מעביר לסוף
      saveState(); renderAll();
    }
    function removeTask(group, idx){
      const ref = group==="mine"?state.mine:state.kids[group];
      ref.splice(idx,1);
      saveState(); renderAll();
    }

    /* ===== סופ״ש ===== */
    function toggleWeekend(){ state.weekend = {done: !(state.weekend?.done)}; saveState(); renderAll(); }
    function skipWeekend(){ // מתקדם שבוע קדימה על ידי כתיבה של "דילגנו" עם חותמת שבוע
      state.weekend = {done:false, skippedAt: Date.now()};
      // לא באמת צריך לשנות אינדקס – הוא מחושב לפי שבוע נוכחי. הדילוג רק לשקט נפשי.
      saveState(); renderAll();
    }

    /* ===== פוקוס צ'ק-ליסט ===== */
    function renderFocus(){
      const wrap = document.getElementById("focus-list");
      const items = state.focus.items || [];
      const hide = state.focus.hideDone;
      wrap.innerHTML = items.filter(i => !(hide && i.done)).map((it,idx)=>`
        <div class="check-item ${it.done?'done':''}">
          <div class="flex-1">
            <div>${it.text}</div>
            ${it.video?`<a class="link tiny" target="_blank" href="${it.video}">🎬 סרטון</a>`:""}
          </div>
          <div class="flex gap-1">
            <button class="btn btn-ghost" title="בוצע" onclick="focusDone(${idx})">✅</button>
            <button class="btn btn-ghost" title="בטל" onclick="focusUndo(${idx})">↩️</button>
            <button class="btn btn-ghost" title="דלג" onclick="focusSkip(${idx})">⏭️</button>
            <button class="btn btn-ghost" title="מחק" onclick="focusRemove(${idx})">🗑️</button>
          </div>
        </div>
      `).join("") || `<div class="tiny">עדיין אין צעדים. הדביקי טקסט ולחצי “צור/עדכן צ׳ק-ליסט”.</div>`;
      document.getElementById("btn-hide-done").classList.toggle("bg-slate-200", hide);
    }

    function parseFocus(text){
      // מזהה שורות עם " - " או תבליטים; מחלץ גם לינקים ל-YouTube אם יש
      return text.split("\n").map(l=>l.trim()).filter(Boolean).map(l=>{
        const m = l.match(/https?:\/\/\S+/);
        return { text: l.replace(m?.[0]||"","").trim(), video: m?.[0]||"", done:false };
      });
    }

    /* ===== אירועים ===== */
    document.getElementById("btn-new").addEventListener("click", ()=>{
      // מרענן משימות היום (שומר לא גמורים ע"י carry אוטומטי ביום הבא)
      state.mine = []; state.kids={mafal:[],maayan:[]};
      saveState(); ensureTodayTasks(); renderAll();
    });

    document.getElementById("btn-make").addEventListener("click", ()=>{
      const txt = document.getElementById("focus-input").value.trim();
      if(!txt) return;
      const parsed = parseFocus(txt);
      // משלבים עם הקיימים – מה שלא קיים נוסף, קיימים נשמרים במצבם
      const existing = state.focus.items || [];
      const merged = [...existing];
      parsed.forEach(p=>{
        if(!merged.some(x=>x.text===p.text)) merged.push(p);
      });
      state.focus.items = merged;
      saveState(); renderFocus();
    });

    document.getElementById("btn-hide-done").addEventListener("click", ()=>{
      state.focus.hideDone = !state.focus.hideDone; saveState(); renderFocus();
    });
    document.getElementById("btn-show-all").addEventListener("click", ()=>{
      state.focus.hideDone = false; saveState(); renderFocus();
    });
    document.getElementById("btn-clear").addEventListener("click", ()=>{
      if(confirm("לנקות את כל הצ'ק-ליסט?")){ state.focus.items=[]; saveState(); renderFocus(); }
    });

    // פעולות פריט פוקוס
    function focusDone(i){ state.focus.items[i].done = true; saveState(); renderFocus(); }
    function focusUndo(i){ state.focus.items[i].done = false; saveState(); renderFocus(); }
    function focusSkip(i){ const [x]=state.focus.items.splice(i,1); state.focus.items.push(x); saveState(); renderFocus(); }
    function focusRemove(i){ state.focus.items.splice(i,1); saveState(); renderFocus(); }

    /* ===== הפעלה ראשונה ===== */
    ensureTodayTasks();
    renderAll();
  </script>
</body>
</html>
<!-- התראות -->
<section class="card p-5 mb-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-lg font-semibold text-gray-800">🔔 תזכורת יומית</h2>
      <p class="tiny">התראה בין 21:00–22:00 להזכיר לסיים משימות. נשמר במכשיר.</p>
    </div>
    <div class="flex gap-2">
      <button id="btn-notify-toggle" class="btn btn-ghost">הפעל תזכורת</button>
      <button id="btn-notify-test" class="btn bg-purple-600 text-white hover:bg-purple-700">בדיקת תזכורת</button>
    </div>
  </div>
  <p id="notify-status" class="tiny mt-2"></p>
</section>
/* ===================== התראות יומיות ===================== */
const NOTIFY_KEY = "steph-org-notify";   // שמירת מצב ההתראה
const statusEl = () => document.getElementById("notify-status");
const toggleBtn = () => document.getElementById("btn-notify-toggle");

function updateNotifyUI(){
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  toggleBtn().textContent = on ? "כבה תזכורת" : "הפעל תזכורת";
  statusEl().textContent = on
    ? "התזכורת פעילה. ההתראה תופיע כל יום בין 21:00–22:00."
    : "התזכורת כבויה.";
}

async function enableNotifications(){
  if(!("Notification" in window)) { alert("הדפדפן לא תומך בהתראות"); return false; }
  let perm = Notification.permission;
  if(perm === "default") perm = await Notification.requestPermission();
  if(perm !== "granted"){ alert("כדי לקבל התראות צריך לאשר בדפדפן"); return false; }
  localStorage.setItem(NOTIFY_KEY, "true");
  scheduleDailyNotification();
  updateNotifyUI();
  return true;
}

function disableNotifications(){
  localStorage.setItem(NOTIFY_KEY, "false");
  clearExistingTimers();
  updateNotifyUI();
}

/* ניהול טיימרים */
let notifyTimerId = null;
function clearExistingTimers(){ if(notifyTimerId){ clearTimeout(notifyTimerId); notifyTimerId=null; } }

/* תזמון: אם עכשיו 21:00–22:00 → נשלח תוך דקה (דמו). אחרת → לתזמן ל־21:00 הבא */
function scheduleDailyNotification(){
  clearExistingTimers();
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  if(!on) return;

  const now = new Date();
  const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 21, 0, 0);
  const end   = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 22, 0, 0);

  let msUntil;
  if(now >= start && now <= end){
    msUntil = 60*1000; // דקה – דמו
  } else {
    const next = (now < start) ? start : new Date(start.getTime()+24*60*60*1000);
    msUntil = next.getTime() - now.getTime();
  }

  notifyTimerId = setTimeout(()=> {
    fireNotification();
    // קובעים שוב לעוד 24 שעות
    notifyTimerId = setTimeout(fireNotification, 24*60*60*1000);
  }, msUntil);
}

function fireNotification(){
  try{
    if("Notification" in window && Notification.permission==="granted"){
      new Notification("זמן לניקיון! 🏠", {
        body: "הגיע הזמן למשימות הבית שלך",
      });
    }
    // גם פופ־אפ קטן בתוך האתר
    try{
      const el = document.createElement("div");
      el.textContent = "זמן לניקיון! הגיע הזמן למשימות הבית שלך 🧽";
      el.style.cssText = "position:fixed;top:16px;left:16px;right:16px;background:#7c3aed;color:#fff;padding:12px 14px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.2);z-index:9999;text-align:center";
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 4000);
    }catch(e){}
  }catch(e){}
}

/* אירועים לכפתורים */
document.getElementById("btn-notify-test").addEventListener("click", fireNotification);
document.getElementById("btn-notify-toggle").addEventListener("click", async ()=>{
  const on = JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false");
  if(on) disableNotifications(); else await enableNotifications();
});

/* אתחול בעת טעינת הדף */
updateNotifyUI();
if(JSON.parse(localStorage.getItem(NOTIFY_KEY)||"false")) scheduleDailyNotification();


