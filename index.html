<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>××¨×’×•×Ÿ ×•×¡×“×¨ âœ¨</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg1:#fff3ff; --bg2:#f8f4ff; --brand:#7c3aed; --brand2:#a855f7; --ink:#1f2937;
    }
    html,body{height:100%}
    body{font-family:Heebo,system-ui;background:radial-gradient(1200px 600px at 80% -10%, #ffe8ff 0%, transparent 60%),
                         radial-gradient(1000px 600px at -10% 0%, #efe9ff 0%, transparent 60%),
                         linear-gradient(180deg,var(--bg2),#ffffff)}
    .glass{backdrop-filter: blur(10px); background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.7)); box-shadow:0 10px 30px rgba(124,58,237,.1); border:1px solid rgba(124,58,237,.12)}
    .chip{display:inline-flex;align-items:center;gap:.4rem;border-radius:999px;padding:.2rem .6rem;font-size:.8rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:12px;padding:.55rem .8rem;font-weight:600}
    .btn-ghost{background:rgba(124,58,237,.08); color:var(--brand)}
    .btn-solid{background:linear-gradient(135deg,var(--brand),var(--brand2));color:white;box-shadow:0 10px 25px rgba(124,58,237,.25)}
    .btn-pill{border-radius:999px}
    .tab{padding:.55rem 1rem;border-radius:12px}
    .grid-cards{display:grid;grid-template-columns:repeat(2, minmax(0,1fr)); gap:.75rem}
    @media (min-width:640px){.grid-cards{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .card{border-radius:18px}
    .progress{height:10px;border-radius:999px;background:#f1e8ff;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,#8b5cf6,#a855f7)}
    .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:.7rem 1rem;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.2);opacity:0;pointer-events:none;transition:.25s}
    .toast.show{opacity:1;pointer-events:auto}
  </style>
</head>
<body class="min-h-screen text-[15px] text-gray-800">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 bg-white/70 backdrop-blur border-b border-purple-100">
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="text-2xl">âœ¨</span>
        <h1 class="font-extrabold text-xl sm:text-2xl text-purple-700">××¨×’×•×Ÿ ×•×¡×“×¨</h1>
      </div>
      <nav class="flex gap-2">
        <button id="tab-home" class="tab bg-purple-600 text-white">×‘×™×ª</button>
        <button id="tab-dash" class="tab hover:bg-purple-50">×“×©×‘×•×¨×“</button>
      </nav>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-5 sm:py-8">
    <!-- HOME VIEW -->
    <section id="view-home" class="space-y-6">
      <!-- TODAY CARDS -->
      <div class="glass card p-4 sm:p-5">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-bold text-lg">××©×™××•×ª ×œ×”×™×•×</h2>
          <div class="flex gap-2">
            <button id="btn-refresh" class="btn btn-ghost">ğŸ”„ ×˜×¢×Ÿ ××©×™××•×ª ×—×“×©×•×ª</button>
            <button id="btn-test-notify" class="btn btn-ghost">ğŸ”” ×‘×“×™×§×ª ×ª×–×›×•×¨×ª</button>
          </div>
        </div>

        <div class="grid gap-4">
          <!-- STEPH -->
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="flex items-center gap-2">
                <span class="chip bg-purple-50 text-purple-700">×¡×˜×¤× ×™</span>
                <span class="text-gray-400 text-sm">(2 ××©×™××•×ª ×§×¦×¨×•×ª ×‘×™××™× ××³â€“×”×³)</span>
              </div>
            </div>
            <ul id="list-steph" class="space-y-2"></ul>
          </div>

          <!-- KIDS -->
          <div class="grid sm:grid-cols-2 gap-4">
            <div class="glass p-3 rounded-xl">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="text-xl">ğŸ§’</span>
                  <span class="font-semibold">×Ö·×¤Ö·×œ â€“ 10</span>
                  <span class="chip bg-emerald-50 text-emerald-700">2 ×™×•××™×•×ª</span>
                </div>
                <div class="text-sm text-emerald-700 font-bold">â­ <span id="pts-mafal">0</span></div>
              </div>
              <ul id="list-mafal" class="space-y-2"></ul>
            </div>

            <div class="glass p-3 rounded-xl">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <span class="text-xl">ğŸ§’</span>
                  <span class="font-semibold">××¢×™×™×Ÿ â€“ 8</span>
                  <span class="chip bg-emerald-50 text-emerald-700">2 ×™×•××™×•×ª</span>
                </div>
                <div class="text-sm text-emerald-700 font-bold">â­ <span id="pts-maayan">0</span></div>
              </div>
              <ul id="list-maayan" class="space-y-2"></ul>
            </div>
          </div>

          <!-- WEEKEND -->
          <div id="weekend-card" class="hidden">
            <div class="flex items-center gap-2 mb-2">
              <span class="chip bg-red-50 text-red-700">×©×™×©×™â€“×©×‘×ª</span>
              <span class="text-gray-400 text-sm">××©×™××•×ª ××•×¨×›×‘×•×ª ×œ×¡×˜×¤× ×™ + 2 ×§×œ×•×ª ×œ×‘× ×•×ª</span>
            </div>
            <ul id="list-weekend" class="space-y-2"></ul>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap gap-2">
          <button id="btn-clear-day" class="btn bg-rose-600 text-white">ğŸ—‘ ××¤×¡ ×™×•×</button>
          <button id="btn-enable-notify" class="btn btn-solid btn-pill">×”×¤×¢×œ ×ª×–×›×•×¨×ª ×™×•××™×ª</button>
        </div>
      </div>

      <!-- DONE TODAY -->
      <div class="glass card p-4">
        <h3 class="font-bold mb-2">××” ×”×•×©×œ× ×”×™×•×</h3>
        <div id="done-today" class="text-gray-500">×¢×“×™×™×Ÿ ×œ× ×”×•×©×œ××• ××©×™××•×ª.</div>
      </div>
    </section>

    <!-- DASH VIEW -->
    <section id="view-dash" class="hidden space-y-6">
      <div class="glass card p-4">
        <h2 class="font-bold text-lg mb-3">×¡×™×›×•× ×—×•×“×©×™</h2>
        <div class="grid-cards">
          <div class="glass p-4 text-center">
            ×“×—×™×ª×™
            <div class="text-3xl font-extrabold text-orange-500" id="stat-defer">0</div>
          </div>
          <div class="glass p-4 text-center">
            ×˜×¨× ×˜×•×¤×œ×•
            <div class="text-3xl font-extrabold text-gray-700" id="stat-open">0</div>
          </div>
          <div class="glass p-4 text-center">
            ×”×•×©×œ××•
            <div class="text-3xl font-extrabold text-emerald-600" id="stat-done">0</div>
          </div>
          <div class="glass p-4 text-center">
            ×“×™×œ×’×ª×™
            <div class="text-3xl font-extrabold text-sky-600" id="stat-skip">0</div>
          </div>
        </div>
      </div>

      <div class="glass card p-4">
        <h2 class="font-bold text-lg mb-4 flex items-center gap-2">×”×ª×§×“××•×ª ×œ×¤×™ ××–×•×¨ (×—×•×“×©×™) <span class="text-xl">ğŸ </span></h2>
        <div id="areas-progress" class="space-y-4"></div>
      </div>

      <div class="glass card p-4">
        <h2 class="font-bold text-lg mb-3">× ×™×§×•×“ ×”×‘× ×•×ª</h2>
        <div class="flex gap-4">
          <div class="glass p-4 rounded-xl flex-1">
            <div class="text-sm text-gray-500">××¤×œ</div>
            <div class="text-3xl font-extrabold text-emerald-600">â­ <span id="pts-mafal-lg">0</span></div>
          </div>
          <div class="glass p-4 rounded-xl flex-1">
            <div class="text-sm text-gray-500">××¢×™×™×Ÿ</div>
            <div class="text-3xl font-extrabold text-emerald-600">â­ <span id="pts-maayan-lg">0</span></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <script>
    // ------------- UTIL -------------
    const qs = s => document.querySelector(s);
    const qsa = s => [...document.querySelectorAll(s)];
    const toast = (msg) => {
      const t = qs('#toast'); t.textContent = msg; t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 1700);
    }
    const todayKey = () => new Date().toISOString().slice(0,10);
    const monthKey = () => new Date().toISOString().slice(0,7);
    const isWeekend = (() => {
      const d=new Date().getDay(); // 0=Sun ... 6=Sat
      return d===5 || d===6; // Fri/Sat
    })();
    const save = () => localStorage.setItem('orgState', JSON.stringify(STATE));
    const load = () => JSON.parse(localStorage.getItem('orgState')||'{}');

    // ------------- DATA (pools) -------------
    // areas & monthly goals (approx how many tasks per month to reach 100%)
    const AREAS = {
      "×¡×œ×•×Ÿ": 20, "××˜×‘×—": 28, "××™": 12, "××¨×¤×¡×ª ×©×™×¨×•×ª": 10, "×—×“×¨ ××©×—×§×™×": 18,
      "×©×™×¨×•×ª×™×/×××‘×˜×™×” ××©×—×§×™×": 12, "×©×™×¨×•×ª×™×/×××‘×˜×™×” ×‘× ×•×ª": 12, "×—×“×¨ ×©×™× ×” ×™×œ×“×™×": 16,
      "×—×“×¨ ××¨×•× ×•×ª": 16, "×—×“×¨ ×©×™× ×” ×”×•×¨×™×": 16, "×©×™×¨×•×ª×™×/×××‘×˜×™×” ×”×•×¨×™×": 12,
      "×—×¦×¨ ×§×“××™×ª": 10, "×—×¦×¨ ××—×•×¨×™×ª": 10
    };

    // Short kids tasks (rotate)
    const KIDS = [
      {title:"×”×¨××” ××”×¡×¤×” â€“ ×¦×¢×¦×•×¢×™×/×‘×’×“×™×", area:"×¡×œ×•×Ÿ"},
      {title:"×”×¨××ª ×“×‘×¨×™× ××”×©×•×œ×—×Ÿ ×‘×¡×œ×•×Ÿ", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×’×•×‘ ×©×•×œ×—×Ÿ ×¡×œ×•×Ÿ/××™", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×’×•×‘ ×”××™ ×‘××˜×‘×—", area:"××™"},
      {title:"××™×¡×•×£ × ×¢×œ×™×™× ×œ×¤×™× ×ª × ×¢×œ×™×™×", area:"×›× ×™×¡×”"},
      {title:"×˜××˜×•× ×¡×œ×•×Ÿ (5 ×“×§×•×ª)", area:"×¡×œ×•×Ÿ"},
      {title:"××™×¡×•×£ ×¦×¢×¦×•×¢×™× ××”×¡×œ×•×Ÿ ×œ×§×•×¤×¡×”", area:"×¡×œ×•×Ÿ"},
      {title:"×”×—×–×¨×ª ×¡×¤×¨×™× ×œ××“×£", area:"×¡×œ×•×Ÿ"},
      {title:"×œ×”×›×™×Ÿ ×ª×™×§ ×œ×‘×•×§×¨ ×œ××—×¨ (×‘××§×•×)", area:"×—×“×¨ ×©×™× ×” ×™×œ×“×™×"},
      {title:"×¡×™×“×•×¨ ×©×•×œ×—×Ÿ ×—×“×¨ ××©×—×§×™×", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"× ×™×’×•×‘ ×”×›×™×•×¨ ×‘×××‘×˜×™×™×ª ××©×—×§×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ××©×—×§×™×"},
      {title:"×”×—×–×¨×ª ×¦×¢×¦×•×¢×™× ×œ×—×“×¨ ××©×—×§×™×", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"××™×¡×•×£ ×›×‘×™×¡×” ×œ×¤×— ×›×‘×™×¡×”", area:"×—×“×¨ ×©×™× ×” ×™×œ×“×™×"},
      {title:"×¤×™× ×•×™ ×¤×— ×§×˜×Ÿ ×‘×—×“×¨ ××©×—×§×™×", area:"×—×“×¨ ××©×—×§×™×"}
    ];

    // Stephanie short tasks (10â€“15m, Sunâ€“Thu)
    const STEPH_SHORT = [
      {title:"×¤×™× ×•×™ ×•× ×™×§×•×™ ×©×•×œ×—×Ÿ ×¡×œ×•×Ÿ", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×’×•×‘ ××©×˜×—×™ ××˜×‘×—", area:"××˜×‘×—"},
      {title:"×¡×™×“×•×¨ ×•× ×™×§×•×™ ×”××™", area:"××™"},
      {title:"××™×•×Ÿ ×¢×¨×™××ª × ×™×™×¨×ª ×§×˜× ×”", area:"×¡×œ×•×Ÿ"},
      {title:"×¡×™×“×•×¨ ×›× ×™×¡×” â€“ × ×¢×œ×™×™×/×ª×™×§×™×", area:"×›× ×™×¡×”"},
      {title:"×¡×™×“×•×¨ ××”×™×¨ ×—×“×¨ ××©×—×§×™× (15×³)", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"× ×™×§×•×™ ××¨××•×ª + ×©×œ×˜ ×¨×—×•×§", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×§×•×™ ×™×“×™×•×ª ×“×œ×ª×•×ª/××ª×’×™×", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×’×•×‘ ××©×˜×— ×××‘×˜×™×™×ª ××©×—×§×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ××©×—×§×™×"},
      {title:"×§×™×¤×•×œ ×›×‘×™×¡×” + ×”×—×–×¨×” ×œ××¨×•×Ÿ", area:"×—×“×¨ ××¨×•× ×•×ª"},
      {title:"×©××™×‘×” ×§×œ×” ×¡×‘×™×‘ ×”×¡×¤×”", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×§×•×™ ××¡×š ×˜×œ×•×•×™×–×™×” ×‘×¢×“×™× ×•×ª", area:"×¡×œ×•×Ÿ"},
      {title:"×¡×™×“×•×¨ ××’×™×¨×ª ×ª×‘×œ×™× ×™× ×§×˜× ×”", area:"××˜×‘×—"},
      {title:"×¡×™×“×•×¨ ××’×™×¨×ª ×’×¨×‘×™×™× (10×³)", area:"×—×“×¨ ××¨×•× ×•×ª"}
    ];

    // Weekend complex for Stephanie
    const WEEKEND_COMPLEX = [
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×¡×œ×•×Ÿ", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ××˜×‘×—", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×—×“×¨ ××©×—×§×™×", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×™×¦×™××” ×œ×—×¦×¨", area:"×—×¦×¨ ××—×•×¨×™×ª"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×××‘×˜×™×™×ª ××©×—×§×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ××©×—×§×™×"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×—×“×¨ ×™×œ×“×™×", area:"×—×“×¨ ×©×™× ×” ×™×œ×“×™×"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×—×“×¨ ×©×™× ×” ×”×•×¨×™×", area:"×—×“×¨ ×©×™× ×” ×”×•×¨×™×"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×•××¡×™×œ×•×ª â€“ ×××‘×˜×™×™×ª ×”×•×¨×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ×”×•×¨×™×"},
      {title:"× ×™×§×•×™ ×¡×¤×•×ª ×™×¡×•×“×™ (××‘×§/×©××™×‘×”/×›×ª××™×)", area:"×¡×œ×•×Ÿ"},
      {title:"×¡×™×“×•×¨ ××¨×•×Ÿ ××—×“ (×—×“×¨ ××¨×•× ×•×ª)", area:"×—×“×¨ ××¨×•× ×•×ª"},
      {title:"×¡×™×“×•×¨ ××¨×•×Ÿ ××˜×‘×— ××—×“", area:"××˜×‘×—"},
      {title:"×¡×™×“×•×¨ ×—×“×¨ ××©×—×§×™× ×¢×•××§ â€“ ×§×•×¤×¡×”/××“×£", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"××™×•×Ÿ ×¦×¢×¦×•×¢×™× ×œ××¡×™×¨×”/×–×¨×™×§×”", area:"×—×“×¨ ××©×—×§×™×"},
      {title:"×˜×™×¤×•×œ ×—×¦×¨ ×§×“××™×ª â€“ ××™×¡×•×£/×¡×™×“×•×¨", area:"×—×¦×¨ ×§×“××™×ª"},
      {title:"×˜×™×¤×•×œ ×—×¦×¨ ××—×•×¨×™×ª â€“ ××™×¡×•×£/×¡×™×“×•×¨", area:"×—×¦×¨ ××—×•×¨×™×ª"},
      {title:"×”×—×œ×¤×ª ××¦×¢×™× â€“ ×—×“×¨ ×™×œ×“×™×", area:"×—×“×¨ ×©×™× ×” ×™×œ×“×™×"},
      {title:"×”×—×œ×¤×ª ××¦×¢×™× â€“ ×—×“×¨ ×©×™× ×” ×”×•×¨×™×", area:"×—×“×¨ ×©×™× ×” ×”×•×¨×™×"}
    ];

    // + Extra housekeeping rotation to reach month depth (bedding etc.)
    const MONTHLY_ROTATION = [
      {title:"×”×—×œ×¤×ª ××¦×¢×™× â€“ ×‘× ×•×ª", area:"×—×“×¨ ×©×™× ×” ×™×œ×“×™×"},
      {title:"×”×—×œ×¤×ª ××¦×¢×™× â€“ ×”×•×¨×™×", area:"×—×“×¨ ×©×™× ×” ×”×•×¨×™×"},
      {title:"× ×™×§×•×™ ××™×§×¨×•×’×œ/×ª× ×•×¨ ×§×¦×¨", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ××§×¨×¨ ××“×£ ××—×“", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ××‘×§ ××“×¤×™ ×¡×œ×•×Ÿ", area:"×¡×œ×•×Ÿ"},
      {title:"×¡×™×“×•×¨ ×ª×™×‘×ª ×ª×¨×•×¤×•×ª", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ××¡×™×œ×•×ª ×“×œ×ª ×”×™×¦×™××”", area:"×—×¦×¨ ××—×•×¨×™×ª"},
      {title:"×¡×™×“×•×¨ ××’×™×¨×ª ×›×œ×™×", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ×¤×—×™× â€“ ×©×˜×™×¤×”", area:"××˜×‘×—"},
      {title:"× ×™×§×•×™ ×›×™×•×¨ ×××‘×˜×™×” ×”×•×¨×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ×”×•×¨×™×"},
      {title:"× ×™×§×•×™ ×›×™×•×¨ ×××‘×˜×™×” ××©×—×§×™×", area:"×©×™×¨×•×ª×™×/×××‘×˜×™×” ××©×—×§×™×"},
      {title:"× ×™×§×•×™ ×—×œ×•× ×•×ª ×§×˜× ×™× ××¡×‘×™×‘ ×œ×‘×™×ª", area:"×¡×œ×•×Ÿ"},
      {title:"× ×™×§×•×™ ××ª×’×™×/×™×“×™×•×ª ×‘×›×œ ×”×‘×™×ª", area:"×¡×œ×•×Ÿ"}
    ];

    // ------------- STATE -------------
    const DEFAULT = {
      month: monthKey(),
      points: {mafal:0, maayan:0},
      history: {}, // dateKey -> [{title,who,area,action,ts}]
      monthDone: 0, monthSkip:0, monthDefer:0,
      todays: {date: todayKey(), open:[], done:[]},
      deferred: [], // {title, who, area, date}
      notify: {enabled:false}
    };
    let STATE = Object.assign({}, DEFAULT, load());

    // reset if month changed
    if(STATE.month !== monthKey()){
      STATE = Object.assign({}, DEFAULT, {points: STATE.points}); // × ×©××•×¨ × ×§×•×“×•×ª
    }
    // reset if day changed
    if(STATE.todays.date !== todayKey()){
      STATE.todays = {date: todayKey(), open:[], done:[]};
    }

    // ------------- GENERATORS -------------
    // small deterministic RNG per day (so ×¨×™×¢× ×•×Ÿ ×œ× ×™×—×œ×™×£ ×›×©×œ× ×œ×•×—×¦×™×)
    function daySeed() {
      const s = todayKey().replaceAll('-',''); let x=0;
      for (let i=0;i<s.length;i++) x = (x*31 + s.charCodeAt(i)) % 9973;
      return () => (x = (x*1103515245+12345) % 2**31) / 2**31;
    }
    function pickN(arr, n, rnd=Math.random){
      const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(rnd()*(i+1)); [a[i],a[j]]=[a[j],a[i]];}
      return a.slice(0,Math.min(n,a.length));
    }

    function buildToday(force=false){
      const rnd = daySeed();
      if(STATE.todays.open.length && !force) return;

      const isWE = isWeekend;
      const open=[];

      // Stephanie â€“ two short Sunâ€“Thu
      if(!isWE){
        pickN(STEPH_SHORT,2,rnd).forEach(t=>open.push({...t, id:crypto.randomUUID(), who:"steph"}));
      } else {
        // complex + 2 kids still appear below
        pickN(WEEKEND_COMPLEX,3,rnd).forEach(t=>open.push({...t, id:crypto.randomUUID(), who:"steph-weekend"}));
      }

      // Kids â€“ always 2+2
      pickN(KIDS,2,rnd).forEach(t=>open.push({...t, id:crypto.randomUUID(), who:"mafal"}));
      pickN(KIDS,2,rnd).forEach(t=>open.push({...t, id:crypto.randomUUID(), who:"maayan"}));

      // monthly rotation â€“ slip one extra depth task some days
      if(rnd()>.6){ open.push({...pickN(MONTHLY_ROTATION,1,rnd)[0], id:crypto.randomUUID(), who:"steph"}); }

      STATE.todays.open = open;
      save();
    }

    // ------------- RENDER -------------
    function taskLi(t){
      return `
      <li class="flex items-center justify-between bg-white border rounded-xl p-3">
        <div class="flex items-center gap-3">
          <span class="text-xl">${t.who==="mafal"?"ğŸ§’":t.who==="maayan"?"ğŸ§’":t.who==="steph-weekend"?"ğŸ§±":"ğŸ§â€â™€ï¸"}</span>
          <div>
            <div class="font-semibold text-gray-800 text-sm">${t.title}</div>
            ${t.area?`<div class="text-xs text-purple-700">${t.area}</div>`:""}
          </div>
        </div>
        <div class="flex gap-1">
          <button class="btn px-2 py-1 text-xs rounded-lg bg-emerald-100 text-emerald-700" data-act="done" data-id="${t.id}" type="button">×‘×•×¦×¢</button>
          <button class="btn px-2 py-1 text-xs rounded-lg bg-sky-100 text-sky-700" data-act="skip" data-id="${t.id}" type="button">×“×œ×’</button>
          <button class="btn px-2 py-1 text-xs rounded-lg bg-amber-100 text-amber-700" data-act="defer" data-id="${t.id}" type="button">×“×—×”</button>
        </div>
      </li>`;
    }

    function renderLists(){
      const open=STATE.todays.open;
      const steph   = open.filter(t=>t.who==="steph");
      const mafal   = open.filter(t=>t.who==="mafal");
      const maayan  = open.filter(t=>t.who==="maayan");
      const weekend = open.filter(t=>t.who==="steph-weekend");

      qs("#list-steph").innerHTML  = steph.length ? steph.map(taskLi).join("") : `<div class="text-sm text-gray-500">××™×Ÿ ×›×¨×’×¢. ×œ×—×¦×™ "×˜×¢×Ÿ ××©×™××•×ª".</div>`;
      qs("#list-mafal").innerHTML  = mafal.length ? mafal.map(taskLi).join("") : `<div class="text-sm text-gray-500">××™×Ÿ ×›×¨×’×¢.</div>`;
      qs("#list-maayan").innerHTML = maayan.length? maayan.map(taskLi).join(""): `<div class="text-sm text-gray-500">××™×Ÿ ×›×¨×’×¢.</div>`;

      const we = qs("#weekend-card");
      if(isWeekend){ we.classList.remove("hidden"); qs("#list-weekend").innerHTML = weekend.length? weekend.map(taskLi).join(""):`<div class="text-sm text-gray-500">××™×Ÿ ×›×¨×’×¢.</div>`; }
      else{ we.classList.add("hidden"); }

      // Done today
      const doneList = STATE.todays.done;
      qs("#done-today").innerHTML = doneList.length
        ? doneList.map(x=>`<div class="bg-green-50 border border-green-100 rounded-lg p-2">âœ… ${x.title}</div>`).join("")
        : "×¢×“×™×™×Ÿ ×œ× ×”×•×©×œ××• ××©×™××•×ª.";
    }

    function renderDashboard(){
      qs("#stat-done").textContent  = STATE.monthDone;
      qs("#stat-skip").textContent  = STATE.monthSkip;
      qs("#stat-defer").textContent = STATE.monthDefer;
      qs("#stat-open").textContent  = STATE.todays.open.length;

      qs("#pts-mafal").textContent = qs("#pts-mafal-lg").textContent = STATE.points.mafal;
      qs("#pts-maayan").textContent= qs("#pts-maayan-lg").textContent= STATE.points.maayan;

      // per-area progress
      const progress = {};
      // collect month history done only
      Object.entries(STATE.history).forEach(([d,items])=>{
        if(!d.startsWith(monthKey())) return;
        items.forEach(it=>{ if(it.action==="done"){ progress[it.area]=(progress[it.area]||0)+1; }});
      });
      const wrap = qs("#areas-progress"); wrap.innerHTML="";
      Object.entries(AREAS).forEach(([area,goal])=>{
        const val = progress[area]||0;
        const pct = Math.min(100, Math.round((val/goal)*100));
        const row = document.createElement("div");
        row.innerHTML = `
          <div class="flex items-center justify-between mb-1">
            <div class="font-semibold">${area}</div>
            <div class="text-sm text-gray-500">${val}/${goal}</div>
          </div>
          <div class="progress"><span style="width:${pct}%"></span></div>
        `;
        wrap.appendChild(row);
      });
    }

    function bindActions(){
      ["list-steph","list-mafal","list-maayan","list-weekend"].forEach(id=>{
        qs("#"+id).addEventListener("click", ev=>{
          const btn = ev.target.closest("button[data-id]"); if(!btn) return;
          const id = btn.dataset.id, act=btn.dataset.act;
          const idx = STATE.todays.open.findIndex(x=>x.id===id); if(idx<0) return;
          const task = STATE.todays.open[idx];
          STATE.todays.open.splice(idx,1);

          const today = todayKey();
          STATE.history[today]=STATE.history[today]||[];

          if(act==="done"){
            STATE.todays.done.push(task);
            STATE.monthDone++;
            STATE.history[today].push({...task, action:"done", ts:Date.now()});

            if(task.who==="mafal")  STATE.points.mafal += 1;
            if(task.who==="maayan") STATE.points.maayan+= 1;
            toast("×›×œ ×”×›×‘×•×“! âœ…");

          } else if(act==="skip"){
            STATE.monthSkip++;
            STATE.history[today].push({...task, action:"skip", ts:Date.now()});
          } else {
            STATE.monthDefer++;
            STATE.deferred.push({...task, action:"defer", date:today});
            STATE.history[today].push({...task, action:"defer", ts:Date.now()});
          }

          save(); renderLists(); renderDashboard();
        }, {passive:true});
      });

      qs("#btn-refresh").onclick = () => { buildToday(true); save(); renderLists(); renderDashboard(); toast("×¨×™×¢× × ×ª×™ ××©×™××•×ª"); };
      qs("#btn-clear-day").onclick= () => {
        STATE.todays = {date:todayKey(), open:[], done:[]};
        buildToday(true); save(); renderLists(); renderDashboard(); toast("××•×¤×¡× ×• ×œ×™×•× ×—×“×©");
      };

      // tabs
      const applyRoute = ()=> {
        const dash = location.hash==="#dash";
        qs("#view-home").classList.toggle("hidden", dash);
        qs("#view-dash").classList.toggle("hidden", !dash);
        qs("#tab-dash").classList.toggle("bg-purple-600", dash);
        qs("#tab-dash").classList.toggle("text-white", dash);
        qs("#tab-home").classList.toggle("bg-purple-600", !dash);
        qs("#tab-home").classList.toggle("text-white", !dash);
      };
      window.addEventListener("hashchange", applyRoute);
      qs("#tab-dash").onclick = ()=>{ location.hash="#dash"; applyRoute(); };
      qs("#tab-home").onclick = ()=>{ location.hash="";      applyRoute(); };
      applyRoute();

      // notifications
      qs("#btn-test-notify").onclick = () => showBrowserNotification(true);
      qs("#btn-enable-notify").onclick = enableDailyNotification;
    }

    // ------------- NOTIFICATIONS -------------
    let scheduleTimer=null;
    function enableDailyNotification(){
      if(!('Notification' in window)){ alert("×”×“×¤×“×¤×Ÿ ×œ× ×ª×•××š ×”×ª×¨××•×ª."); return; }
      if(Notification.permission==='granted'){
        STATE.notify.enabled=true; save(); scheduleDaily(); toast("×”×ª×–×›×•×¨×ª ×”×•×¤×¢×œ×”");
      } else if(Notification.permission==='default'){
        Notification.requestPermission().then(p=>{
          if(p==='granted'){ STATE.notify.enabled=true; save(); scheduleDaily(); toast("×”×ª×–×›×•×¨×ª ×”×•×¤×¢×œ×”"); }
          else alert("×›×“×™ ×œ×§×‘×œ ×”×ª×¨××•×ª ×¦×¨×™×š ×œ××©×¨ ×‘×“×¤×“×¤×Ÿ");
        });
      } else {
        alert("×”×ª×¨××•×ª ×—×¡×•××•×ª ×‘×“×¤×“×¤×Ÿ. ××¤×©×¨ ×œ×©× ×•×ª ×‘×”×’×“×¨×•×ª ×”××ª×¨.");
      }
    }
    function scheduleDaily(){
      clearTimeout(scheduleTimer);
      // next 21:00 today/××—×¨
      const now=new Date();
      const target=new Date(now.getFullYear(),now.getMonth(),now.getDate(),21,0,0);
      if(now>target) target.setDate(target.getDate()+1);
      const ms=target-now;
      scheduleTimer = setTimeout(()=>{
        showBrowserNotification();
        scheduleDaily(); // reschedule to tomorrow
      }, ms);
    }
    function showBrowserNotification(force){
      if(!force && !STATE.notify.enabled) return;
      try{
        new Notification('×–××Ÿ ×œ× ×™×§×™×•×Ÿ! ğŸ ', {body:'×‘×•××™ ×œ×¡×™×™× 2-3 ××©×™××•×ª ×§×¦×¨×•×ª ×¢×›×©×™×• ğŸ™‚'});
      }catch(e){ /* ignore */ }
      toast("ğŸ”” ×ª×–×›×•×¨×ª × ×©×œ×—×”");
    }

    // ------------- INIT -------------
    buildToday(false);
    renderLists(); renderDashboard();
    bindActions();
    if(STATE.notify.enabled) scheduleDaily();
  </script>
</body>
</html>
